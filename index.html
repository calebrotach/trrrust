<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trusts: The Financial Chameleon</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Mermaid.js for flowcharts -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ 
            startOnLoad: false,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#1e293b',
                primaryTextColor: '#f8fafc',
                primaryBorderColor: '#3b82f6',
                lineColor: '#06b6d4',
                secondaryColor: '#0f172a',
                tertiaryColor: '#1e293b',
                background: '#0f172a',
                mainBkg: '#1e293b',
                secondBkg: '#0f172a',
                textColor: '#f8fafc',
                border1: '#3b82f6',
                border2: '#06b6d4',
                arrowheadColor: '#3b82f6',
                clusterBkg: '#1e293b',
                clusterBorder: '#3b82f6',
                defaultLinkColor: '#06b6d4',
                titleColor: '#f8fafc',
                edgeLabelBackground: '#1e293b',
                actorBorder: '#3b82f6',
                actorBkg: '#1e293b',
                actorTextColor: '#f8fafc',
                actorLineColor: '#06b6d4',
                signalColor: '#f8fafc',
                signalTextColor: '#f8fafc',
                labelBoxBkgColor: '#1e293b',
                labelBoxBorderColor: '#3b82f6',
                labelTextColor: '#f8fafc',
                loopTextColor: '#f8fafc',
                noteBorderColor: '#8b5cf6',
                noteBkgColor: '#1e293b',
                noteTextColor: '#f8fafc',
                activationBorderColor: '#06b6d4',
                activationBkgColor: '#1e293b',
                sequenceNumberColor: '#f8fafc',
                sectionBkgColor: '#1e293b',
                altBkgColor: '#0f172a',
                altBorderColor: '#3b82f6'
            }
        });
        window.mermaid = mermaid;
    </script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">

    <!-- 
        PALETTE: Future Finance / Electric Night
        Background: #0f172a (Slate 900)
        Card BG: #1e293b (Slate 800)
        Text Main: #f8fafc (Slate 50)
        Text Muted: #94a3b8 (Slate 400)
        Accent 1 (Blue): #3b82f6
        Accent 2 (Cyan): #06b6d4
        Accent 3 (Purple): #8b5cf6
        Accent 4 (Pink): #ec4899
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a;
            color: #f8fafc;
        }
        
        html {
            scroll-behavior: smooth;
        }
        
        /* Section summary links */
        #summaries a {
            text-decoration: none;
            color: inherit;
        }
        
        #summaries a:hover {
            transform: translateY(-2px);
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0f172a;
        }
        ::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 4px;
        }

        /* Chart Container Standards */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* Max width constraint */
            margin-left: auto;
            margin-right: auto;
            height: 300px; /* Base height */
            max-height: 400px;
        }
        
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }

        .glass-panel {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.1);
        }

        .gradient-text {
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Flowchart Timeline Styles */
        .flow-timeline {
            position: relative;
            padding: 2rem 0;
            max-height: 600px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .flow-timeline::before {
            content: '';
            position: absolute;
            left: 35px;
            top: 0;
            bottom: 0;
            width: 3px;
            background: linear-gradient(180deg, #3b82f6, #06b6d4, #8b5cf6);
            border-radius: 2px;
            animation: pulse-line 3s ease-in-out infinite;
        }

        @keyframes pulse-line {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        .flow-step {
            position: relative;
            margin-bottom: 2rem;
            padding-left: 5rem;
            opacity: 0;
            animation: fadeInSlide 0.6s ease-out forwards;
        }

        .flow-step:nth-child(1) { animation-delay: 0.1s; }
        .flow-step:nth-child(2) { animation-delay: 0.2s; }
        .flow-step:nth-child(3) { animation-delay: 0.3s; }
        .flow-step:nth-child(4) { animation-delay: 0.4s; }
        .flow-step:nth-child(5) { animation-delay: 0.5s; }
        .flow-step:nth-child(6) { animation-delay: 0.6s; }
        .flow-step:nth-child(7) { animation-delay: 0.7s; }

        @keyframes fadeInSlide {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .flow-step-badge {
            position: absolute;
            left: 0;
            top: 0;
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 800;
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            z-index: 2;
            transition: all 0.3s ease;
            border: 4px solid #0f172a;
        }

        .flow-step-badge::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            opacity: 0;
            z-index: -1;
            transition: all 0.3s ease;
        }

        .flow-step:hover .flow-step-badge {
            transform: scale(1.15);
            box-shadow: 0 6px 25px rgba(59, 130, 246, 0.6);
        }

        .flow-step:hover .flow-step-badge::after {
            opacity: 0.3;
            transform: scale(1.5);
        }

        .flow-step-content {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            backdrop-filter: blur(10px);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .flow-step-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, #3b82f6, #06b6d4);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .flow-step:hover .flow-step-content {
            border-color: rgba(59, 130, 246, 0.6);
            transform: translateX(10px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.2);
        }

        .flow-step:hover .flow-step-content::before {
            transform: scaleY(1);
        }

        .flow-step-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: white;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #ffffff, #94a3b8);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .flow-step-description {
            color: #94a3b8;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .flow-connector {
            position: absolute;
            left: 35px;
            top: 70px;
            width: 3px;
            height: calc(100% + 1rem);
            background: linear-gradient(180deg, #06b6d4, #3b82f6);
            z-index: 1;
        }

        .flow-step:last-child .flow-connector {
            display: none;
        }

        /* Smooth scrollbar for flow timeline */
        .flow-timeline::-webkit-scrollbar {
            width: 10px;
        }
        .flow-timeline::-webkit-scrollbar-track {
            background: rgba(15, 23, 42, 0.5);
            border-radius: 5px;
        }
        .flow-timeline::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3b82f6, #06b6d4);
            border-radius: 5px;
        }
        .flow-timeline::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #06b6d4, #3b82f6);
        }
        
        /* Mermaid Diagram Styling */
        .mermaid-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
        }
        
        .mermaid {
            background: transparent;
            max-width: 100%;
        }
        
        .mermaid svg {
            max-width: 100%;
            height: auto;
        }
        
        /* Ensure Mermaid text is visible */
        .mermaid .nodeLabel,
        .mermaid .edgeLabel {
            color: #f8fafc !important;
        }
    </style>
    <!-- 
        HTML COMMENT: Source Material Analysis & Plan
        1. Definition: Explained via Grantor/Trustee/Beneficiary model.
        2. Types: Compared Revocable vs Irrevocable.
        3. Hedge Funds: Clarified LP vs Trust structure.
        4. Demographics: Visualized wealth gap in usage.
        5. Barriers: Visualized survey data on why people avoid them.
        6. Alts: Visualized the shift to real estate/crypto and custody issues.
        7. LLM Tools: Added two Gemini features (Definition Generator, Grounded Regulatory Search).
        
        NO SVG USED. NO MERMAID JS USED.
        Visualizations:
        - Chart.js (Bar, Doughnut, Radar, Mixed)
        - CSS/HTML Diagrams (Flowcharts)
    -->
</head>
<body class="antialiased selection:bg-cyan-500 selection:text-white">

    <!-- Navigation / Header -->
    <nav class="sticky top-0 z-50 bg-[#0f172a]/90 backdrop-blur-md border-b border-slate-800 shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-extrabold tracking-tight"><span class="text-blue-500">TRUSTED</span><span class="text-cyan-400">RESEARCH</span></span>
                </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-4">
                        <a href="#anatomy" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Anatomy</a>
                        <a href="#adoption" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Adoption</a>
                        <a href="#assets" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Alt Assets</a>
                        <a href="#example" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Example</a>
                        <a href="#trust-types" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Trust Types</a>
                        <a href="#pitch-deck" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">Pitch Deck</a>
                        <a href="#mvp-analysis" class="hover:text-blue-400 px-3 py-2 rounded-md text-sm font-medium transition">MVP Analysis</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="relative overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24">
            <div class="text-center">
                <h1 class="text-4xl sm:text-6xl font-extrabold tracking-tight mb-4">
                    Getting to <span class="gradient-text">MVP</span>
                </h1>
                <p class="mt-4 max-w-2xl mx-auto text-xl text-slate-400">
                    Dissecting trusts into modular components and building a minimum viable product from comprehensive research.
                </p>
                <div class="mt-8 flex justify-center gap-4">
                    <div class="bg-slate-800 p-4 rounded-lg shadow-lg border border-slate-700 text-center w-32">
                        <div class="text-3xl font-bold text-blue-500">$5T+</div>
                        <div class="text-xs text-slate-400 uppercase tracking-wide">Assets in US Trusts</div>
                    </div>
                    <div class="bg-slate-800 p-4 rounded-lg shadow-lg border border-slate-700 text-center w-32">
                        <div class="text-3xl font-bold text-cyan-400">2%</div>
                        <div class="text-xs text-slate-400 uppercase tracking-wide">US Adults with a Trust</div>
                    </div>
                    <div class="bg-slate-800 p-4 rounded-lg shadow-lg border border-slate-700 text-center w-32">
                        <div class="text-3xl font-bold text-purple-500">40%</div>
                        <div class="text-xs text-slate-400 uppercase tracking-wide">Growth in Alt Assets</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Section Summaries -->
    <section id="summaries" class="py-12 bg-[#0f172a] border-b border-slate-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-8">
                <h2 class="text-3xl font-bold text-white mb-4">Section Summaries</h2>
                <p class="text-slate-400 text-lg">
                    Quick overview of each section to help you navigate the content.
                </p>
            </div>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                <a href="#anatomy" class="glass-panel p-5 rounded-xl hover:border-blue-500 transition border border-slate-700 block cursor-pointer">
                    <div class="text-2xl font-bold text-blue-400 mb-2">1. Anatomy</div>
                    <p class="text-sm text-slate-300 mb-2">The DNA of Every Trust</p>
                    <p class="text-xs text-slate-400">
                        Explains the fundamental tripartite structure: Grantor, Trustee, and Beneficiary. Uses a visual diagram to show how legal title and equitable title are split, and clarifies common confusions about hedge funds, REITs, and governance structures.
                    </p>
                </a>
                <a href="#adoption" class="glass-panel p-5 rounded-xl hover:border-cyan-500 transition border border-slate-700 block cursor-pointer">
                    <div class="text-2xl font-bold text-cyan-400 mb-2">2. Adoption</div>
                    <p class="text-sm text-slate-300 mb-2">Usage & The Wealth Gap</p>
                    <p class="text-xs text-slate-400">
                        Visualizes trust adoption rates by net worth, revealing a significant wealth gap. Shows that only 2% of US adults have trusts despite $5T+ in trust assets, and identifies key barriers preventing broader adoption including misconceptions and legal costs.
                    </p>
                </a>
                <a href="#assets" class="glass-panel p-5 rounded-xl hover:border-purple-500 transition border border-slate-700 block cursor-pointer">
                    <div class="text-2xl font-bold text-purple-400 mb-2">3. Alt Assets</div>
                    <p class="text-sm text-slate-300 mb-2">The Asset Evolution</p>
                    <p class="text-xs text-slate-400">
                        Examines the shift from traditional portfolios (stocks, bonds) to alternative assets (real estate, crypto, private equity) in modern trusts. Highlights challenges: custody, liquidity, and valuation requirements that make alternative assets complex to manage in trusts.
                    </p>
                </a>
                <a href="#example" class="glass-panel p-5 rounded-xl hover:border-emerald-500 transition border border-slate-700 block cursor-pointer">
                    <div class="text-2xl font-bold text-emerald-400 mb-2">4. Example</div>
                    <p class="text-sm text-slate-300 mb-2">Trust in Action</p>
                    <p class="text-xs text-slate-400">
                        Interactive visual diagram showing how trust components interact in real-world examples (ILIT, Revocable Living Trust, GRAT, CRT). Includes responsive flowcharts with step-by-step processes, module breakdowns, and examples featuring alternative assets like real estate and private equity.
                    </p>
                </a>
                <a href="#trust-types" class="glass-panel p-5 rounded-xl hover:border-yellow-500 transition border border-slate-700 block cursor-pointer">
                    <div class="text-2xl font-bold text-yellow-400 mb-2">5. Trust Types</div>
                    <p class="text-sm text-slate-300 mb-2">Modular Analysis</p>
                    <p class="text-xs text-slate-400">
                        Comprehensive database of 25+ trust types with modular categorization. Features search, filtering by modules, usage statistics. Click statistics to see which trusts use each module.
                    </p>
                </a>
                <a href="#pitch-deck" class="glass-panel p-5 rounded-xl hover:border-indigo-500 transition border border-slate-700 block cursor-pointer">
                    <div class="text-2xl font-bold text-indigo-400 mb-2">6. Pitch Deck</div>
                    <p class="text-sm text-slate-300 mb-2">Orion Innovation</p>
                    <p class="text-xs text-slate-400">
                        Customized pitch deck for automating trust creation and execution, tailored to Orion Innovation's digital transformation expertise. Covers three-phase implementation (Data Layer, Rules Framework Testing, Money Movement), business value, and how Orion's 12 global delivery centers provide strategic advantage.
                    </p>
                </a>
                <a href="#mvp-analysis" class="glass-panel p-5 rounded-xl hover:border-rose-500 transition border border-slate-700 block cursor-pointer">
                    <div class="text-2xl font-bold text-rose-400 mb-2">7. MVP Analysis</div>
                    <p class="text-sm text-slate-300 mb-2">Building the Foundation</p>
                    <p class="text-xs text-slate-400">
                        Calculates which modules need to be built to serve various percentages of popular trusts. Defines MVP as top 8 most-used modules and shows which trust types would be covered. Includes coverage analysis at different module counts (8, 10, 15, all) with strategic insights for development prioritization.
                    </p>
                </a>
            </div>
        </div>
    </section>

    <!-- Section 1: The Anatomy of a Trust -->
    <section id="anatomy" class="py-12 bg-slate-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-white mb-4">1. The DNA of Every Trust</h2>
                <p class="text-slate-400 text-lg">
                    Regardless of complexity, every trust shares the same tripartite structure. Think of it as a <strong class="text-blue-400">safety deposit box</strong> where one person puts items in, another holds the key, and a third gets to use the contents according to a rulebook.
                </p>
            </div>

            <!-- CSS Diagram: The Trust Flow (Full Width with Examples) -->
            <div class="glass-panel p-8 lg:p-12 rounded-2xl relative overflow-hidden">
                <!-- Vertical Flow Diagram -->
                <div class="flex flex-col items-center space-y-8 lg:space-y-10 relative max-w-4xl mx-auto">
                    <!-- Grantor (Top) -->
                    <div class="bg-blue-600/20 border-2 border-blue-500 p-6 lg:p-8 rounded-xl text-center w-full max-w-md z-10 shadow-lg shadow-blue-500/20">
                        <h3 class="font-bold text-blue-400 text-xl lg:text-2xl mb-2">The Grantor</h3>
                        <p class="text-sm text-slate-300 mb-4">Creator & Funder</p>
                        <div class="mt-4 pt-4 border-t border-blue-500/30">
                            <p class="text-xs text-blue-300 font-semibold mb-2">Example Actions:</p>
                            <div class="space-y-1 text-xs text-slate-300">
                                <div>‚Ä¢ Transfers $2M in stocks, bonds, and real estate</div>
                                <div>‚Ä¢ Funds ILIT with $5M life insurance policy</div>
                                <div>‚Ä¢ Contributes private equity shares to GRAT</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Arrow Down from Grantor -->
                    <div class="flex flex-col items-center z-10">
                        <svg width="50" height="50" viewBox="0 0 50 50" class="text-blue-400">
                            <path d="M25 0 L25 35 M15 25 L25 35 L35 25" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="text-sm text-slate-300 font-semibold mt-2">Transfers Assets</span>
                    </div>

                    <!-- Trust Agreement (Middle) -->
                    <div class="bg-purple-600/20 border-2 border-purple-500 p-6 lg:p-8 rounded-xl text-center w-full max-w-lg z-10 shadow-lg shadow-purple-500/20">
                        <h3 class="font-bold text-purple-400 text-xl lg:text-2xl mb-2">üìú Trust Agreement</h3>
                        <p class="text-sm text-slate-300 mb-4">The Rulebook</p>
                        <div class="mt-4 pt-4 border-t border-purple-500/30">
                            <p class="text-xs text-purple-300 font-semibold mb-2">Example Terms:</p>
                            <div class="space-y-1 text-xs text-slate-300 text-left">
                                <div>‚Ä¢ Distribution rules: "Income to spouse, principal to children at age 25"</div>
                                <div>‚Ä¢ Trustee powers: "May invest in stocks, bonds, real estate, and alternatives"</div>
                                <div>‚Ä¢ Revocability: "Irrevocable trust, grantor retains no control"</div>
                            </div>
                        </div>
                    </div>

                    <!-- Arrow Down from Agreement -->
                    <div class="flex flex-col items-center z-10">
                        <svg width="50" height="50" viewBox="0 0 50 50" class="text-purple-400">
                            <path d="M25 0 L25 35 M15 25 L25 35 L35 25" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                        <span class="text-sm text-slate-300 font-semibold mt-2">Defines Terms</span>
                    </div>

                    <!-- Trustee and Beneficiary Side by Side -->
                    <div class="flex flex-col lg:flex-row items-center gap-8 lg:gap-10 w-full justify-center">
                        <!-- Trustee (Left) -->
                        <div class="bg-cyan-600/20 border-2 border-cyan-500 p-6 lg:p-8 rounded-xl text-center w-full lg:w-80 z-10 shadow-lg shadow-cyan-500/20">
                            <h3 class="font-bold text-cyan-400 text-xl lg:text-2xl mb-2">‚öñÔ∏è The Trustee</h3>
                            <p class="text-sm text-slate-300 mb-2">Manager & Fiduciary</p>
                            <p class="text-xs text-cyan-300 font-semibold mb-4">Holds Legal Title</p>
                            <div class="mt-4 pt-4 border-t border-cyan-500/30">
                                <p class="text-xs text-cyan-300 font-semibold mb-2">Example Responsibilities:</p>
                                <div class="space-y-1 text-xs text-slate-300 text-left">
                                    <div>‚Ä¢ Manages portfolio: rebalances quarterly, selects investments</div>
                                    <div>‚Ä¢ Distributes $50K annually to beneficiary per agreement</div>
                                    <div>‚Ä¢ Files tax returns (Form 1041) and maintains records</div>
                                </div>
                            </div>
                        </div>

                        <!-- Arrow Right from Trustee to Beneficiary -->
                        <div class="flex flex-col items-center z-10 lg:rotate-0 rotate-90">
                            <svg width="60" height="40" viewBox="0 0 60 40" class="text-cyan-400">
                                <path d="M0 20 L45 20 M35 10 L45 20 L35 30" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                            <span class="text-sm text-slate-300 font-semibold mt-2">Manages For</span>
                        </div>

                        <!-- Beneficiary (Right) -->
                        <div class="bg-emerald-600/20 border-2 border-emerald-500 p-6 lg:p-8 rounded-xl text-center w-full lg:w-80 z-10 shadow-lg shadow-emerald-500/20">
                            <h3 class="font-bold text-emerald-400 text-xl lg:text-2xl mb-2">üë• The Beneficiary</h3>
                            <p class="text-sm text-slate-300 mb-2">Recipient</p>
                            <p class="text-xs text-emerald-300 font-semibold mb-4">Holds Equitable Title</p>
                            <div class="mt-4 pt-4 border-t border-emerald-500/30">
                                <p class="text-xs text-emerald-300 font-semibold mb-2">Example Benefits:</p>
                                <div class="space-y-1 text-xs text-slate-300 text-left">
                                    <div>‚Ä¢ Receives $50K annual distributions for living expenses</div>
                                    <div>‚Ä¢ Inherits full trust assets at age 35 (principal distribution)</div>
                                    <div>‚Ä¢ Protected from creditors; assets not counted in divorce</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 2: Flavors & Adoption -->
    <section id="adoption" class="py-12 bg-[#0f172a]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-white mb-4">2. Usage & The Wealth Gap</h2>
                <p class="text-slate-400 text-lg">
                    Trusts are powerful tools for privacy and probate avoidance, yet they remain underutilized by the middle class. Why? Perceived complexity and cost create a massive barrier to entry.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                
                <!-- Chart: Trust Adoption by Net Worth -->
                <div class="glass-panel p-6 rounded-xl">
                    <h3 class="text-xl font-bold text-white mb-2">Trust Usage by Net Worth</h3>
                    <p class="text-sm text-slate-400 mb-6">Percentage of households utilizing trust structures.</p>
                    <div class="chart-container">
                        <canvas id="adoptionChart"></canvas>
                    </div>
                    <p class="mt-4 text-xs text-slate-500 italic">Data simulated based on estate planning industry reports.</p>
                </div>

                <!-- Chart: Barriers to Entry -->
                <div class="glass-panel p-6 rounded-xl">
                    <h3 class="text-xl font-bold text-white mb-2">Why Don't More People Use Them?</h3>
                    <p class="text-sm text-slate-400 mb-6">Top reasons cited by individuals with >$500k assets.</p>
                    <div class="chart-container">
                        <canvas id="barriersChart"></canvas>
                    </div>
                    <div class="mt-4 grid grid-cols-2 gap-2 text-xs text-slate-400">
                        <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-blue-500 mr-2"></span>Misconception ("Rich Only")</div>
                        <div class="flex items-center"><span class="w-2 h-2 rounded-full bg-cyan-400 mr-2"></span>Legal Costs</div>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- Section 3: Asset Mix & Alternatives -->
    <section id="assets" class="py-12 bg-slate-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-white mb-4">3. The Asset Evolution</h2>
                <p class="text-slate-400 text-lg">
                    Traditionally, trusts held boring mixes of stocks and municipal bonds. Today, <strong>Self-Directed Trusts</strong> are aggressively moving into alternative assets. This shift presents massive regulatory hurdles regarding custody and valuation.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- Chart: Traditional vs Modern Portfolio -->
                <div class="lg:col-span-2 glass-panel p-6 rounded-xl">
                    <h3 class="text-xl font-bold text-white mb-2">Portfolio Shift: Traditional vs. Modern Trust</h3>
                    <p class="text-sm text-slate-400 mb-6">The modern trust is diversifying away from public equities into "Hard" and "Digital" assets.</p>
                    <div class="chart-container" style="max-width: 100%;">
                        <canvas id="portfolioChart"></canvas>
                    </div>
                </div>

                <!-- Qualitative: The Difficulty of Alts -->
                <div class="glass-panel p-6 rounded-xl flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl font-bold text-white mb-4">Why is it Hard?</h3>
                        <ul class="space-y-4">
                            <li class="flex items-start">
                                <div class="bg-red-500/20 p-2 rounded mr-3 mt-1">
                                    <span class="text-red-400 font-bold">!</span>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-200">Custody & Control</h4>
                                    <p class="text-sm text-slate-400">If a trust owns Bitcoin, who holds the private keys? Institutional custody is required for compliance, but expensive.</p>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <div class="bg-yellow-500/20 p-2 rounded mr-3 mt-1">
                                    <span class="text-yellow-400 font-bold">!</span>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-200">Liquidity Events</h4>
                                    <p class="text-sm text-slate-400">You can't sell 1/10th of a commercial building to pay a beneficiary. Alts create cash-flow jams.</p>
                                </div>
                            </li>
                            <li class="flex items-start">
                                <div class="bg-blue-500/20 p-2 rounded mr-3 mt-1">
                                    <span class="text-blue-400 font-bold">!</span>
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-200">Valuation (IRS 401)</h4>
                                    <p class="text-sm text-slate-400">Private Equity and Art don't have a daily ticker price. Annual appraisals are costly but mandatory.</p>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div class="mt-6 pt-6 border-t border-slate-700">
                        <h4 class="text-sm font-bold text-cyan-400 uppercase tracking-wider mb-2">Most Desired Alts</h4>
                        <div class="flex flex-wrap gap-2">
                            <span class="px-3 py-1 bg-slate-700 rounded-full text-xs text-white">Private Equity</span>
                            <span class="px-3 py-1 bg-slate-700 rounded-full text-xs text-white">Multi-Family Real Estate</span>
                            <span class="px-3 py-1 bg-slate-700 rounded-full text-xs text-white">Crypto/DeFi</span>
                            <span class="px-3 py-1 bg-slate-700 rounded-full text-xs text-white">Farmland</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 4: Gemini LLM Tools (HIDDEN) -->
    <section id="tools" class="py-12 bg-[#0f172a]" style="display: none;">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-white mb-4">4. Trust Analyst Tools ‚ú®</h2>
                <p class="text-slate-400 text-lg">
                    Leverage Generative AI to quickly summarize complex trust concepts or find the latest regulatory information impacting alternative assets.
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Tool 1: Trust Definition Generator -->
                <div class="glass-panel p-6 rounded-xl">
                    <h3 class="text-xl font-bold text-blue-400 mb-4">‚ú® Explain a Trust Type</h3>
                    <p class="text-sm text-slate-400 mb-4">Select a trust type from the dropdown to get a concise breakdown.</p>
                    <div class="space-y-4">
                        <select id="trustInput" class="w-full px-4 py-2 rounded-lg bg-slate-700 text-white focus:ring-blue-500 focus:border-blue-500 border border-slate-600">
                            <option value="">-- Select a Trust Type --</option>
                        </select>
                        <button id="generateDefinitionBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg transition duration-200">
                            Generate Definition ‚ú®
                        </button>
                        <div id="definitionLoading" class="hidden text-cyan-400 text-sm text-center">Analyzing request...</div>
                        <div id="definitionOutput" class="p-4 bg-slate-800 rounded-lg border border-slate-700 min-h-[100px] text-sm whitespace-pre-wrap">
                            <p class="text-slate-500 italic">Definition will appear here.</p>
                        </div>
                    </div>
                </div>

                <!-- Tool 2: Regulatory Update Analyzer (Grounded) -->
                <div class="glass-panel p-6 rounded-xl">
                    <h3 class="text-xl font-bold text-cyan-400 mb-4">‚ú® Alt Asset Regulatory Insight</h3>
                    <p class="text-sm text-slate-400 mb-4">Get a grounded summary of the latest regulatory changes affecting alternative assets in trusts.</p>
                    <div class="space-y-4">
                        <input type="text" id="regulatoryInput" placeholder="e.g., SEC guidance on crypto custody in trusts" class="w-full px-4 py-2 rounded-lg bg-slate-700 text-white placeholder-slate-500 focus:ring-cyan-500 focus:border-cyan-500 border border-slate-600">
                        <button id="generateRegulatoryBtn" class="w-full bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 rounded-lg transition duration-200">
                            Get Latest Update (Web Grounded) ‚ú®
                        </button>
                        <div id="regulatoryLoading" class="hidden text-blue-400 text-sm text-center">Searching the web for updates...</div>
                        <div id="regulatoryOutput" class="p-4 bg-slate-800 rounded-lg border border-slate-700 min-h-[100px] text-sm whitespace-pre-wrap">
                            <p class="text-slate-500 italic">Latest regulatory summary will appear here, with sources.</p>
                        </div>
                        <div id="regulatorySources" class="mt-2 text-xs text-slate-500"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Section 4: Trust Example - Visual Diagram -->
    <section id="example" class="py-12 bg-slate-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-white mb-4">4. Trust in Action: ILIT Example</h2>
                <p class="text-slate-400 text-lg">
                    See how all the pieces fit together in a real-world example. This diagram shows an <strong class="text-blue-400">Irrevocable Life Insurance Trust (ILIT)</strong> and how each component interacts.
                </p>
            </div>

            <!-- Trust Type Selector -->
            <div class="glass-panel p-6 rounded-xl mb-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-center">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Select Trust Example:</label>
                        <select id="trustExampleSelect" class="w-full px-4 py-2 rounded-lg bg-slate-700 text-white border border-slate-600 focus:ring-blue-500 focus:border-blue-500">
                            <option value="revocable">Revocable Living Trust</option>
                            <option value="ilit">Irrevocable Life Insurance Trust (ILIT)</option>
                            <option value="bypass">Bypass Trust (Credit Shelter Trust)</option>
                            <option value="qtip">QTIP Trust</option>
                            <option value="dynasty">Dynasty Trust</option>
                            <option value="grat">Grantor Retained Annuity Trust (GRAT)</option>
                            <option value="crt">Charitable Remainder Trust (CRT)</option>
                            <option value="clt">Charitable Lead Trust (CLT)</option>
                            <option value="qprt">Qualified Personal Residence Trust (QPRT)</option>
                            <option value="snt">Special Needs Trust (SNT)</option>
                            <option value="asset">Asset Protection Trust</option>
                            <option value="business">Business Succession Trust</option>
                            <option value="gst">Generation-Skipping Trust (GST)</option>
                            <option value="idgt">Intentionally Defective Grantor Trust (IDGT)</option>
                        </select>
                    </div>
                    <div class="md:col-span-2">
                        <p id="trustDescription" class="text-slate-300 text-sm leading-relaxed"></p>
                    </div>
                </div>
            </div>

            <!-- Interactive Trust Diagram -->
            <div class="glass-panel p-4 sm:p-6 lg:p-8 rounded-xl relative overflow-visible" id="trustDiagram">
                <!-- Diagram will be rendered here by JavaScript -->
            </div>

            <!-- Module Breakdown -->
            <div class="mt-8 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="moduleBreakdown">
                <!-- Module cards will be populated by JavaScript -->
            </div>

            <!-- Flow Explanation -->
            <div class="mt-8 glass-panel p-6 rounded-xl">
                <h3 class="text-xl font-bold text-white mb-6 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-blue-500 animate-pulse"></span>
                    How It Works: Step-by-Step
                </h3>
                <div id="flowExplanation" class="flow-timeline">
                    <!-- Flow steps will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </section>

    <!-- Section 5: Comprehensive Trust Types Database -->
    <section id="trust-types" class="py-12 bg-[#0f172a]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-white mb-4">5. Trust Types: Modular Analysis</h2>
                <p class="text-slate-400 text-lg">
                    Every trust is built from modular components. Search by trust name or filter by modules to understand shared characteristics and differences across trust types.
                </p>
            </div>

            <!-- Module Glossary -->
            <div class="glass-panel p-6 rounded-xl mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-white">Module Glossary</h3>
                    <button id="glossaryToggle" class="text-sm text-blue-400 hover:text-blue-300 transition" onclick="toggleGlossary()">
                        <span id="glossaryToggleText">Show</span> Definitions
                    </button>
                </div>
                <div id="glossaryContent" class="hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Revocability -->
                        <div class="bg-slate-800 p-4 rounded-lg border-l-4 border-blue-500">
                            <h4 class="font-bold text-blue-400 mb-2">Revocability</h4>
                            <p class="text-sm text-slate-300 mb-3">Determines whether the grantor can modify or terminate the trust after creation.</p>
                            <div class="space-y-2 text-xs">
                                <div>
                                    <span class="font-semibold text-slate-200">Revocable:</span>
                                    <span class="text-slate-400"> Grantor can modify, amend, or revoke the trust at any time. Assets remain in grantor's estate for tax purposes.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Revocable Living Trust - allows flexibility during lifetime</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Irrevocable:</span>
                                    <span class="text-slate-400"> Trust cannot be modified or revoked once established. Assets removed from grantor's estate.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: ILIT, GRAT - provides tax benefits but sacrifices control</div>
                                </div>
                            </div>
                        </div>

                        <!-- Tax Treatment -->
                        <div class="bg-slate-800 p-4 rounded-lg border-l-4 border-purple-500">
                            <h4 class="font-bold text-purple-400 mb-2">Tax Treatment</h4>
                            <p class="text-sm text-slate-300 mb-3">Tax strategies and benefits the trust provides.</p>
                            <div class="space-y-2 text-xs">
                                <div>
                                    <span class="font-semibold text-slate-200">Estate Tax Reduction:</span>
                                    <span class="text-slate-400"> Removes assets from taxable estate, reducing estate tax liability.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Dynasty Trust, Bypass Trust - shields assets from estate tax</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Income Tax Planning:</span>
                                    <span class="text-slate-400"> Optimizes income tax treatment, often through grantor trust status.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: IDGT - grantor pays taxes, trust grows tax-free</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Gift Tax Exclusion:</span>
                                    <span class="text-slate-400"> Utilizes annual gift tax exclusion ($18,000+ per recipient) or lifetime exemption.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Crummey Trust - leverages annual exclusion gifts</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Generation-Skipping:</span>
                                    <span class="text-slate-400"> Transfers assets to grandchildren or later generations, skipping estate tax on children.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: GST Trust, Dynasty Trust - multi-generational planning</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Charitable Deduction:</span>
                                    <span class="text-slate-400"> Provides income tax deduction for charitable contributions.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: CRT, CLT - immediate tax deduction for charitable giving</div>
                                </div>
                            </div>
                        </div>

                        <!-- Primary Purpose -->
                        <div class="bg-slate-800 p-4 rounded-lg border-l-4 border-cyan-500">
                            <h4 class="font-bold text-cyan-400 mb-2">Primary Purpose</h4>
                            <p class="text-sm text-slate-300 mb-3">The main objective or goal the trust is designed to achieve.</p>
                            <div class="space-y-2 text-xs">
                                <div>
                                    <span class="font-semibold text-slate-200">Estate Planning:</span>
                                    <span class="text-slate-400"> Avoids probate, manages asset distribution, minimizes taxes.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Revocable Living Trust, QTIP Trust - core estate planning tools</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Asset Protection:</span>
                                    <span class="text-slate-400"> Shields assets from creditors, lawsuits, or beneficiary mismanagement.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Asset Protection Trust, Spendthrift Trust - creditor protection</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Charitable Giving:</span>
                                    <span class="text-slate-400"> Facilitates charitable donations with tax benefits.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: CRT, CLT - structured charitable giving</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Business Succession:</span>
                                    <span class="text-slate-400"> Transfers business interests to next generation efficiently.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Business Succession Trust - smooth business transition</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Special Needs:</span>
                                    <span class="text-slate-400"> Preserves government benefits eligibility while providing supplemental support.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Special Needs Trust - maintains SSI/Medicaid eligibility</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Life Insurance Planning:</span>
                                    <span class="text-slate-400"> Removes life insurance from estate, provides tax-free death benefit.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: ILIT - estate tax-free insurance proceeds</div>
                                </div>
                            </div>
                        </div>

                        <!-- Control Structure -->
                        <div class="bg-slate-800 p-4 rounded-lg border-l-4 border-pink-500">
                            <h4 class="font-bold text-pink-400 mb-2">Control Structure</h4>
                            <p class="text-sm text-slate-300 mb-3">Who has decision-making authority over trust assets and distributions.</p>
                            <div class="space-y-2 text-xs">
                                <div>
                                    <span class="font-semibold text-slate-200">Grantor Retains Control:</span>
                                    <span class="text-slate-400"> Grantor maintains significant control, often as trustee or with retained powers.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Revocable Living Trust, QPRT - grantor manages assets</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Trustee Discretion:</span>
                                    <span class="text-slate-400"> Trustee has broad discretion over distributions and investments.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Dynasty Trust, Asset Protection Trust - trustee decides distributions</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Beneficiary Control:</span>
                                    <span class="text-slate-400"> Beneficiaries have direct control or significant influence over trust decisions.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Some self-directed trusts - beneficiary investment control</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Limited Control:</span>
                                    <span class="text-slate-400"> Control is restricted by trust terms, often for protection or tax reasons.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Special Needs Trust - limited to preserve benefits</div>
                                </div>
                            </div>
                        </div>

                        <!-- Distribution Method -->
                        <div class="bg-slate-800 p-4 rounded-lg border-l-4 border-emerald-500">
                            <h4 class="font-bold text-emerald-400 mb-2">Distribution Method</h4>
                            <p class="text-sm text-slate-300 mb-3">How and when trust assets are distributed to beneficiaries.</p>
                            <div class="space-y-2 text-xs">
                                <div>
                                    <span class="font-semibold text-slate-200">Income Only:</span>
                                    <span class="text-slate-400"> Beneficiaries receive only income generated by trust assets, not principal.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: QTIP Trust, Bypass Trust - income stream to spouse</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Principal Access:</span>
                                    <span class="text-slate-400"> Beneficiaries can access both income and principal, often with restrictions.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Revocable Living Trust - full access during lifetime</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Discretionary:</span>
                                    <span class="text-slate-400"> Trustee decides when and how much to distribute based on beneficiary needs.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Dynasty Trust, Asset Protection Trust - flexible distributions</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Mandatory:</span>
                                    <span class="text-slate-400"> Trust requires specific distributions at set intervals or events.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: GRAT - fixed annuity payments, Pet Trust - care funding</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Charitable Remainder:</span>
                                    <span class="text-slate-400"> Assets ultimately go to charity after providing income to beneficiaries.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: CRT, CLT - remainder interest to charity</div>
                                </div>
                            </div>
                        </div>

                        <!-- Special Features -->
                        <div class="bg-slate-800 p-4 rounded-lg border-l-4 border-yellow-500">
                            <h4 class="font-bold text-yellow-400 mb-2">Special Features</h4>
                            <p class="text-sm text-slate-300 mb-3">Unique characteristics or asset types that define the trust's structure.</p>
                            <div class="space-y-2 text-xs">
                                <div>
                                    <span class="font-semibold text-slate-200">Life Insurance:</span>
                                    <span class="text-slate-400"> Trust is funded with or designed to hold life insurance policies.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: ILIT - removes insurance from estate</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Real Estate:</span>
                                    <span class="text-slate-400"> Trust holds real property, often with specific transfer or privacy benefits.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: QPRT, Land Trust, DST - real estate holding structures</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Business Interests:</span>
                                    <span class="text-slate-400"> Trust holds business equity, facilitating succession planning.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Business Succession Trust - transfers business ownership</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Medicaid Planning:</span>
                                    <span class="text-slate-400"> Designed to qualify for Medicaid while preserving assets for heirs.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: Medicaid Asset Protection Trust - 5-year lookback planning</div>
                                </div>
                                <div>
                                    <span class="font-semibold text-slate-200">Generation-Skipping:</span>
                                    <span class="text-slate-400"> Transfers assets to grandchildren or later generations, skipping children's estate.</span>
                                    <div class="mt-1 text-slate-500 italic">Example: GST Trust, Dynasty Trust - multi-generational transfers</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter Controls -->
            <div class="glass-panel p-6 rounded-xl mb-8">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Search Trust Types</label>
                        <input type="text" id="trustSearch" placeholder="Type to search (e.g., GRAT, Revocable, Charitable)" class="w-full px-4 py-2 rounded-lg bg-slate-700 text-white placeholder-slate-500 focus:ring-blue-500 focus:border-blue-500 border border-slate-600">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">Filter by Modules</label>
                        <div id="moduleFilterContainer" class="flex flex-wrap gap-2 max-h-32 overflow-y-auto p-2 bg-slate-800 rounded-lg border border-slate-600">
                            <!-- Module checkboxes will be populated by JavaScript -->
                        </div>
                        <p class="text-xs text-slate-500 mt-1">Click modules to filter. Click stats below for quick filter.</p>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2" id="activeFilters"></div>
            </div>

            <!-- Module Statistics -->
            <div class="glass-panel p-6 rounded-xl mb-8">
                <h3 class="text-xl font-bold text-white mb-4">Module Usage Statistics</h3>
                <p class="text-xs text-slate-400 mb-4">Click a statistic to see which trust types use that module</p>
                <div id="moduleStats" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    <!-- Stats will be populated by JavaScript -->
                </div>
            </div>

            <!-- Modal for showing trust types by module -->
            <div id="moduleTrustsModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 hidden p-4" style="display: none;">
                <div class="glass-panel rounded-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col">
                    <div class="p-6 border-b border-slate-700 flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold text-white" id="modalModuleName"></h3>
                            <p class="text-sm text-slate-400 mt-1" id="modalModuleCount"></p>
                        </div>
                        <button onclick="closeModuleModal()" class="text-slate-400 hover:text-white text-2xl font-bold w-8 h-8 flex items-center justify-center rounded-lg hover:bg-slate-700 transition">√ó</button>
                    </div>
                    <div class="p-6 overflow-y-auto flex-1" id="modalTrustList">
                        <!-- Trust types list will be populated here -->
                    </div>
                    <div class="p-4 border-t border-slate-700 flex gap-3">
                        <button onclick="closeModuleModal()" class="flex-1 px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition">Close</button>
                        <button onclick="applyModuleFilterFromModal()" class="flex-1 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition">Filter by This Module</button>
                    </div>
                </div>
            </div>

            <!-- Trust Types Grid -->
            <div id="trustTypesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Trust cards will be populated by JavaScript -->
            </div>

            <!-- Comparison View -->
            <div id="comparisonView" class="hidden mt-8 glass-panel p-6 rounded-xl">
                <h3 class="text-xl font-bold text-white mb-4">Selected Trusts Comparison</h3>
                <div id="comparisonTable" class="overflow-x-auto">
                    <!-- Comparison table will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </section>

    <!-- Section 6: Pitch Deck Generator for Orion Innovation -->
    <section id="pitch-deck" class="py-12 bg-slate-900">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-white mb-4">6. Trust Automation Pitch: Orion Innovation</h2>
                <p class="text-slate-400 text-lg">
                    Generate a customized pitch deck for automating trust creation and execution, tailored to Orion Innovation's digital transformation expertise and financial services focus.
                </p>
            </div>

            <div class="glass-panel p-6 rounded-xl mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-xl font-bold text-white">Generate Pitch Deck</h3>
                    <button onclick="generatePitchDeck()" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition">
                        Generate Pitch Deck
                    </button>
                </div>
                <p class="text-sm text-slate-400">
                    Click to generate a comprehensive pitch deck showcasing how automated trust solutions can transform Orion Innovation's Wealth & Asset Management services.
                </p>
            </div>

            <!-- Pitch Deck Container -->
            <div id="pitchDeckContainer" class="space-y-6">
                <!-- Pitch slides will be generated here -->
            </div>
        </div>
    </section>

    <!-- Section 7: MVP Module Analysis -->
    <section id="mvp-analysis" class="py-12 bg-[#0f172a]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10">
                <h2 class="text-3xl font-bold text-white mb-4">7. MVP Module Analysis: Building the Foundation</h2>
                <p class="text-slate-400 text-lg">
                    Calculate which modules need to be built to serve various percentages of popular trusts. 
                    The MVP (Minimum Viable Product) focuses on the top 8 most-used modules to maximize coverage with minimal development.
                </p>
            </div>
            <div id="mvpAnalysis" class="space-y-6">
                <!-- MVP analysis will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-[#0f172a] border-t border-slate-800 py-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-slate-500 text-sm">&copy; 2023 TrustedResearch Analytics. For educational purposes only.</p>
        </div>
    </footer>

    <!-- Chart Logic and LLM Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        let app;
        let db;
        let auth;
        const API_KEY = "AIzaSyAWagOnlC5jbJmH3Bu0gaM42bFjxqcHb8w"; 
        const API_URL_BASE = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";

        // Firebase Setup (Mandatory environment initialization)
        const initFirebase = async () => {
            try {
                const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Firebase initialization or sign-in failed:", error);
            }
        };

        initFirebase();

        // LLM Core Function with Exponential Backoff
        const callGeminiApi = async (userQuery, systemPrompt = "", useSearch = false, maxRetries = 5) => {
            const url = `${API_URL_BASE}${API_KEY}`;
            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: systemPrompt }] },
                tools: useSearch ? [{ "google_search": {} }] : undefined
            };

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.status === 429) {
                        const delay = Math.pow(2, i) * 1000;
                        await new Promise(resolve => setTimeout(resolve, delay));
                        continue;
                    }

                    if (!response.ok) {
                        throw new Error(`API call failed with status: ${response.status}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        const text = candidate.content.parts[0].text;
                        
                        let sources = [];
                        const groundingMetadata = candidate.groundingMetadata;
                        if (groundingMetadata && groundingMetadata.groundingAttributions) {
                            sources = groundingMetadata.groundingAttributions
                                .map(attribution => ({
                                    uri: attribution.web?.uri,
                                    title: attribution.web?.title,
                                }))
                                .filter(source => source.uri && source.title);
                        }

                        return { text, sources };
                    } else {
                        throw new Error("Invalid response structure from Gemini API.");
                    }
                } catch (error) {
                    if (i === maxRetries - 1) throw error;
                }
            }
        };

        // Populate trust type dropdown
        function populateTrustDropdown() {
            const select = document.getElementById('trustInput');
            if (!select || !TRUST_TYPES) return;
            
            // Sort trust types alphabetically by name
            const sortedTrusts = [...TRUST_TYPES].sort((a, b) => a.name.localeCompare(b.name));
            
            sortedTrusts.forEach(trust => {
                const option = document.createElement('option');
                option.value = trust.name;
                option.textContent = trust.name;
                select.appendChild(option);
            });
        }

        // LLM Feature 1: Trust Definition Generator
        const generateTrustDefinition = async () => {
            const input = document.getElementById('trustInput').value.trim();
            const outputElement = document.getElementById('definitionOutput');
            const loadingElement = document.getElementById('definitionLoading');
            
            if (!input) {
                outputElement.innerHTML = `<p class="text-red-400 italic">Please select a trust type to explain.</p>`;
                return;
            }

            loadingElement.classList.remove('hidden');
            outputElement.innerHTML = `<p class="text-slate-500 italic">Thinking...</p>`;

            const systemPrompt = "You are a world-class fiduciary and financial educator. Summarize the user-provided trust type. Your response must be in three distinct sections: Purpose (What it does), Key Features (e.g., revocable/irrevocable, tax implications), and Use Case (Who uses it). Use simple, professional language.";
            const userQuery = `Explain the following trust type: ${input}`;

            try {
                const result = await callGeminiApi(userQuery, systemPrompt, false);
                outputElement.innerText = result.text;
            } catch (error) {
                console.error("Gemini Definition Error:", error);
                outputElement.innerHTML = `<p class="text-red-400 italic">Error generating definition. Please check the console for details.</p>`;
            } finally {
                loadingElement.classList.add('hidden');
            }
        };

        // LLM Feature 2: Regulatory Update Analyzer (Grounded)
        const generateRegulatoryUpdate = async () => {
            const input = document.getElementById('regulatoryInput').value.trim();
            const outputElement = document.getElementById('regulatoryOutput');
            const sourcesElement = document.getElementById('regulatorySources');
            const loadingElement = document.getElementById('regulatoryLoading');

            if (!input) {
                outputElement.innerHTML = `<p class="text-red-400 italic">Please enter a specific regulatory topic to search.</p>`;
                return;
            }

            loadingElement.classList.remove('hidden');
            outputElement.innerHTML = `<p class="text-slate-500 italic">Searching for the latest regulatory updates on ${input}...</p>`;
            sourcesElement.innerHTML = '';

            const systemPrompt = "You are a financial compliance officer. Search for the latest regulatory guidance or changes (last 12 months) related to the user's query concerning trusts and alternative assets. Provide a concise, bulleted summary of the key findings. Only use information provided by the search results.";
            const userQuery = `Find and summarize recent regulatory updates regarding: ${input}`;

            try {
                const result = await callGeminiApi(userQuery, systemPrompt, true);
                outputElement.innerText = result.text;

                if (result.sources.length > 0) {
                    sourcesElement.innerHTML = `<strong>Sources:</strong> ${result.sources.map(s => `<a href="${s.uri}" target="_blank" class="text-blue-400 hover:text-blue-300 underline">${s.title}</a>`).join(' | ')}`;
                } else {
                    sourcesElement.innerHTML = `<p class="text-slate-500 italic">No specific web sources cited.</p>`;
                }
            } catch (error) {
                console.error("Gemini Grounded Search Error:", error);
                outputElement.innerHTML = `<p class="text-red-400 italic">Error retrieving regulatory update. Please check the console for details.</p>`;
            } finally {
                loadingElement.classList.add('hidden');
            }
        };
        
        // Event Listeners for LLM tools
        document.getElementById('generateDefinitionBtn').addEventListener('click', generateTrustDefinition);
        document.getElementById('generateRegulatoryBtn').addEventListener('click', generateRegulatoryUpdate);


        // ----------------------------------------------------
        // Existing Chart Logic (Kept for Infographic Functionality)
        // ----------------------------------------------------

        // Global defaults for dark theme
        Chart.defaults.color = '#94a3b8';
        Chart.defaults.font.family = 'Inter';
        Chart.defaults.scale.grid.color = 'rgba(148, 163, 184, 0.1)';

        // Label Wrapping Utility
        function wrapLabel(str, maxChars) {
            if (str.length <= maxChars) return str;
            const words = str.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                if (currentLine.length + 1 + words[i].length <= maxChars) {
                    currentLine += ' ' + words[i];
                } else {
                    lines.push(currentLine);
                    currentLine = words[i];
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // 1. Adoption Chart (Bar)
        const ctxAdoption = document.getElementById('adoptionChart').getContext('2d');
        new Chart(ctxAdoption, {
            type: 'bar',
            data: {
                labels: ['Under $100k', '$100k - $1M', '$1M - $5M', '$5M - $20M', 'Ultra HNW ($20M+)'],
                datasets: [{
                    label: 'Trust Utilization Rate (%)',
                    data: [2, 8, 28, 65, 92],
                    backgroundColor: [
                        '#1e293b',
                        '#334155', 
                        '#3b82f6',
                        '#60a5fa', 
                        '#06b6d4'
                    ],
                    borderRadius: 6,
                    borderWidth: 0
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                let label = context[0].label;
                                return Array.isArray(label) ? label.join(' ') : label;
                            }
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: { display: true, text: 'Utilization %' }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });

        // 2. Barriers Chart (Donut)
        const ctxBarriers = document.getElementById('barriersChart').getContext('2d');
        const barrierLabels = [
            "Perceived as 'Rich Only'", 
            "Setup & Legal Costs", 
            "Complexity/Confusion", 
            "Loss of Control Fears", 
            "Procrastination"
        ];
        // Wrap labels
        const wrappedBarrierLabels = barrierLabels.map(l => wrapLabel(l, 16));

        new Chart(ctxBarriers, {
            type: 'doughnut',
            data: {
                labels: wrappedBarrierLabels,
                datasets: [{
                    data: [42, 25, 18, 10, 5],
                    backgroundColor: [
                        '#3b82f6',
                        '#06b6d4',
                        '#8b5cf6',
                        '#ec4899',
                        '#64748b'
                    ],
                    borderWidth: 0,
                    hoverOffset: 10
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'right',
                        labels: {
                            color: '#cbd5e1',
                            font: { size: 10 }
                        }
                    },
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                let label = context[0].chart.data.labels[context[0].dataIndex];
                                return Array.isArray(label) ? label.join(' ') : label;
                            }
                        }
                    }
                }
            }
        });

        // 3. Portfolio Shift (Horizontal Stacked Bar)
        const ctxPortfolio = document.getElementById('portfolioChart').getContext('2d');
        new Chart(ctxPortfolio, {
            type: 'bar',
            data: {
                labels: ['Traditional Trust', 'Modern/Alt Trust'],
                datasets: [
                    {
                        label: 'Public Equities',
                        data: [60, 35],
                        backgroundColor: '#3b82f6',
                        barThickness: 40
                    },
                    {
                        label: 'Bonds/Cash',
                        data: [35, 15],
                        backgroundColor: '#64748b',
                        barThickness: 40
                    },
                    {
                        label: 'Real Estate',
                        data: [5, 30],
                        backgroundColor: '#06b6d4',
                        barThickness: 40
                    },
                    {
                        label: 'Private Equity/Crypto',
                        data: [0, 20],
                        backgroundColor: '#8b5cf6',
                        barThickness: 40
                    }
                ]
            },
            options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    x: {
                        stacked: true,
                        max: 100,
                        title: { display: true, text: 'Asset Allocation %' }
                    },
                    y: {
                        stacked: true
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            title: function(context) {
                                let label = context[0].label;
                                return Array.isArray(label) ? label.join(' ') : label;
                            }
                        }
                    }
                }
            }
        });

        // ----------------------------------------------------
        // Trust Example Diagram
        // ----------------------------------------------------

        const TRUST_EXAMPLES = {
            ilit: {
                name: 'Irrevocable Life Insurance Trust (ILIT)',
                description: 'Removes life insurance from estate while providing tax-free death benefit to beneficiaries.',
                grantor: {
                    name: 'John (Grantor)',
                    actions: ['Creates trust', 'Funds with gifts', 'Pays gift tax on premiums'],
                    assets: ['$50,000 annual gifts', 'Life Insurance Policy', 'Real estate (rental property)']
                },
                trustee: {
                    name: 'Sarah (Trustee)',
                    actions: ['Manages trust', 'Pays insurance premiums', 'Distributes to beneficiaries'],
                    powers: ['Investment decisions', 'Distribution discretion']
                },
                beneficiary: {
                    name: 'Children (Beneficiaries)',
                    receives: ['Tax-free death benefit', 'Discretionary distributions'],
                    timing: 'After grantor\'s death'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Crummey withdrawal rights', 'Spendthrift provisions'],
                    taxBenefits: ['Estate tax exclusion', 'Gift tax annual exclusion']
                },
                flow: [
                    { step: 1, title: 'Trust Creation', description: 'Grantor creates irrevocable trust and names trustee and beneficiaries.' },
                    { step: 2, title: 'Funding', description: 'Grantor makes annual gifts to trust (up to $18,000 per beneficiary, indexed). May include real estate or other alternative assets.' },
                    { step: 3, title: 'Crummey Notice', description: 'Beneficiaries receive withdrawal rights notice (typically 30-60 days).' },
                    { step: 4, title: 'Premium Payment', description: 'Trustee uses trust funds to pay life insurance premiums. Rental income from real estate assets can fund premiums.' },
                    { step: 5, title: 'Policy Ownership', description: 'Trust owns the policy, removing it from grantor\'s estate. Alternative assets remain in trust.' },
                    { step: 6, title: 'Death Benefit', description: 'Upon grantor\'s death, insurance pays tax-free to trust. Real estate and other assets also pass to trust.' },
                    { step: 7, title: 'Distribution', description: 'Trustee distributes proceeds to beneficiaries per trust terms. May include sale of real estate or continued management.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Gift Tax Exclusion'],
                    primaryPurpose: ['Life Insurance Planning', 'Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: ['Life Insurance']
                }
            },
            revocable: {
                name: 'Revocable Living Trust',
                description: 'Avoids probate while maintaining full control during lifetime.',
                grantor: {
                    name: 'John (Grantor/Trustee)',
                    actions: ['Creates trust', 'Transfers assets', 'Manages investments', 'Can revoke anytime'],
                    assets: ['Home', 'Investment accounts', 'Bank accounts', 'Commercial real estate', 'Private equity interests']
                },
                trustee: {
                    name: 'John (Same as Grantor)',
                    actions: ['Manages all assets', 'Makes distributions', 'Can modify trust'],
                    powers: ['Full control', 'Can be own trustee']
                },
                beneficiary: {
                    name: 'Spouse & Children',
                    receives: ['Income during lifetime', 'Assets after death'],
                    timing: 'During lifetime and after death'
                },
                trustAgreement: {
                    terms: ['Revocable', 'Grantor as trustee', 'Pour-over will backup'],
                    taxBenefits: ['No estate tax benefit', 'Avoids probate']
                },
                flow: [
                    { step: 1, title: 'Trust Creation', description: 'Grantor creates revocable trust and names successor trustee.' },
                    { step: 2, title: 'Asset Transfer', description: 'Grantor transfers assets into trust: home, accounts, commercial real estate, and private equity interests. Real estate requires deed transfer.' },
                    { step: 3, title: 'Lifetime Management', description: 'Grantor manages trust assets as trustee, retains full control. Can collect rental income, manage real estate, or sell alternative assets.' },
                    { step: 4, title: 'Modification Rights', description: 'Grantor can modify, amend, or revoke trust at any time, including adding/removing alternative assets.' },
                    { step: 5, title: 'Incapacity', description: 'If grantor becomes incapacitated, successor trustee takes over management of all assets including real estate and alternative investments.' },
                    { step: 6, title: 'Death', description: 'Upon death, all assets (including real estate and alternative assets) pass to beneficiaries without probate.' },
                    { step: 7, title: 'Distribution', description: 'Successor trustee distributes assets per trust terms. May sell real estate, transfer property deeds, or continue managing alternative assets.' }
                ],
                modules: {
                    revocability: ['Revocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                }
            },
            grat: {
                name: 'Grantor Retained Annuity Trust (GRAT)',
                description: 'Transfers appreciating assets to beneficiaries with minimal gift tax exposure.',
                grantor: {
                    name: 'John (Grantor)',
                    actions: ['Creates GRAT', 'Transfers assets', 'Receives annuity payments'],
                    assets: ['$2M in stock', 'Business interests', 'Commercial real estate', 'Private equity fund interests']
                },
                trustee: {
                    name: 'Corporate Trustee',
                    actions: ['Manages assets', 'Pays annuity to grantor', 'Distributes remainder'],
                    powers: ['Investment management', 'Annuity calculation']
                },
                beneficiary: {
                    name: 'Children',
                    receives: ['Remainder interest', 'Appreciation above hurdle rate'],
                    timing: 'After annuity term (typically 2-10 years)'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Fixed annuity term', 'Remainder to beneficiaries'],
                    taxBenefits: ['Freezes asset value', 'Transfers appreciation tax-free']
                },
                flow: [
                    { step: 1, title: 'GRAT Creation', description: 'Grantor creates irrevocable GRAT with fixed term (e.g., 5 years).' },
                    { step: 2, title: 'Asset Transfer', description: 'Grantor transfers appreciating assets to GRAT: stock, business interests, commercial real estate, or private equity. Real estate requires professional valuation and deed transfer.' },
                    { step: 3, title: 'Gift Tax Calculation', description: 'Gift value = asset value minus present value of annuity payments. Alternative assets require annual appraisals for valuation.' },
                    { step: 4, title: 'Annuity Payments', description: 'GRAT pays fixed annuity to grantor annually (based on IRS rate). Can be funded by rental income from real estate or asset sales.' },
                    { step: 5, title: 'Asset Growth', description: 'Assets appreciate within GRAT during the term. Real estate and private equity may appreciate significantly, exceeding hurdle rate.' },
                    { step: 6, title: 'Term Completion', description: 'After term ends, remainder (appreciation) goes to beneficiaries. May include real estate, private equity interests, or cash from sales.' },
                    { step: 7, title: 'Tax Benefit', description: 'Only initial gift value taxed; all appreciation transfers tax-free. Particularly valuable for rapidly appreciating alternative assets.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Gift Tax Exclusion'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Mandatory'],
                    specialFeatures: []
                }
            },
            crt: {
                name: 'Charitable Remainder Trust (CRT)',
                description: 'Provides income to beneficiaries with remainder going to charity, generating tax deduction.',
                grantor: {
                    name: 'John (Grantor)',
                    actions: ['Creates CRT', 'Transfers appreciated assets', 'Receives income stream'],
                    assets: ['$1M appreciated stock', 'Commercial real estate', 'Art collection', 'Private equity interests']
                },
                trustee: {
                    name: 'Charitable Organization or Individual',
                    actions: ['Manages assets', 'Pays income to grantor', 'Distributes remainder to charity'],
                    powers: ['Investment management', 'Charitable distribution']
                },
                beneficiary: {
                    name: 'John (Income Beneficiary) & Charity (Remainder)',
                    receives: ['Income stream (5-7% annually)', 'Charity gets remainder'],
                    timing: 'Income during lifetime, remainder at death'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Fixed income percentage', 'Charitable remainder'],
                    taxBenefits: ['Charitable income tax deduction', 'Avoids capital gains on sale']
                },
                flow: [
                    { step: 1, title: 'CRT Creation', description: 'Grantor creates irrevocable CRT and names charity as remainder beneficiary.' },
                    { step: 2, title: 'Asset Transfer', description: 'Grantor transfers appreciated assets to CRT: stock, commercial real estate, art collection, or private equity. Alternative assets require professional appraisals.' },
                    { step: 3, title: 'Charitable Deduction', description: 'Grantor receives immediate income tax deduction for remainder value. Larger deduction possible with highly appreciated alternative assets.' },
                    { step: 4, title: 'Asset Sale', description: 'Trustee sells assets tax-free (no capital gains to grantor). Real estate and art can be sold without triggering capital gains tax to grantor.' },
                    { step: 5, title: 'Income Payments', description: 'Trust pays fixed percentage (5-7%) to grantor annually. Can be funded by rental income from retained real estate or investment returns.' },
                    { step: 6, title: 'Lifetime Income', description: 'Grantor receives income stream for life or fixed term. Income can be generated from diversified portfolio including alternative assets.' },
                    { step: 7, title: 'Charitable Remainder', description: 'Upon death or term end, remaining assets go to charity. May include remaining real estate, investment portfolio, or cash from asset sales.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Income Tax Planning', 'Charitable Deduction'],
                    primaryPurpose: ['Charitable Giving', 'Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Income Only', 'Charitable Remainder'],
                    specialFeatures: []
                }
            },
            bypass: {
                name: 'Bypass Trust (Credit Shelter Trust)',
                description: 'Maximizes estate tax exemption by utilizing both spouses\' exemptions.',
                grantor: {
                    name: 'John & Mary (Married Couple)',
                    actions: ['Creates trust in will', 'Funds with exemption amount', 'Provides for surviving spouse'],
                    assets: ['$13.61M (2024 exemption)', 'Investment portfolio', 'Real estate', 'Business interests']
                },
                trustee: {
                    name: 'Corporate Trustee or Family Member',
                    actions: ['Manages trust assets', 'Provides income to spouse', 'Preserves exemption'],
                    powers: ['Investment management', 'Distribution discretion', 'Principal access decisions']
                },
                beneficiary: {
                    name: 'Surviving Spouse (Income) & Children (Remainder)',
                    receives: ['Income during spouse\'s lifetime', 'Principal if needed', 'Remainder to children'],
                    timing: 'Income during lifetime, remainder after second death'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Surviving spouse income rights', 'Remainder to children'],
                    taxBenefits: ['Doubles estate tax exemption', 'Estate tax deferral']
                },
                flow: [
                    { step: 1, title: 'First Spouse Death', description: 'Upon first spouse\'s death, assets up to exemption amount ($13.61M in 2024) fund the bypass trust.' },
                    { step: 2, title: 'Trust Funding', description: 'Assets transferred to bypass trust: investment accounts, real estate, business interests. Real estate requires deed transfer and valuation.' },
                    { step: 3, title: 'Exemption Preservation', description: 'Bypass trust uses first spouse\'s exemption, preserving it from estate tax. Surviving spouse\'s exemption remains available.' },
                    { step: 4, title: 'Income Distribution', description: 'Trustee provides income to surviving spouse from trust assets. Can include rental income from real estate or dividends from investments.' },
                    { step: 5, title: 'Principal Access', description: 'Surviving spouse may access principal for health, education, maintenance, and support (HEMS standard).' },
                    { step: 6, title: 'Asset Growth', description: 'Assets grow within bypass trust, free from estate tax. Real estate and alternative assets can appreciate significantly.' },
                    { step: 7, title: 'Second Death', description: 'Upon surviving spouse\'s death, bypass trust assets pass to children free of estate tax, effectively doubling the exemption.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Income Only', 'Principal Access'],
                    specialFeatures: []
                }
            },
            qtip: {
                name: 'QTIP Trust (Qualified Terminable Interest Property)',
                description: 'Provides income to surviving spouse while controlling ultimate distribution.',
                grantor: {
                    name: 'John (Deceased Spouse)',
                    actions: ['Creates trust in will', 'Funds with assets', 'Names spouse as income beneficiary'],
                    assets: ['$5M estate', 'Investment portfolio', 'Real estate', 'Business interests']
                },
                trustee: {
                    name: 'Corporate Trustee or Family Member',
                    actions: ['Manages trust assets', 'Pays income to spouse', 'Controls ultimate distribution'],
                    powers: ['Investment management', 'Income distribution', 'Remainder beneficiary control']
                },
                beneficiary: {
                    name: 'Mary (Surviving Spouse - Income) & Children (Remainder)',
                    receives: ['All income during lifetime', 'Principal access limited', 'Remainder to children'],
                    timing: 'Income during spouse\'s lifetime, remainder after death'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Qualified terminable interest', 'Marital deduction eligible'],
                    taxBenefits: ['Marital deduction', 'Estate tax deferral', 'Controls ultimate beneficiaries']
                },
                flow: [
                    { step: 1, title: 'Grantor Death', description: 'Upon grantor\'s death, assets fund QTIP trust. Estate receives marital deduction, deferring estate tax.' },
                    { step: 2, title: 'Trust Funding', description: 'Assets transferred to QTIP trust: investments, real estate, business interests. Real estate requires deed transfer and valuation.' },
                    { step: 3, title: 'Marital Deduction', description: 'Estate receives unlimited marital deduction, deferring all estate tax until surviving spouse\'s death.' },
                    { step: 4, title: 'Income Requirement', description: 'Trustee must pay all income to surviving spouse annually. Income includes dividends, interest, and rental income from real estate.' },
                    { step: 5, title: 'Principal Restrictions', description: 'Surviving spouse has limited access to principal. Trustee has discretion but typically only for HEMS needs.' },
                    { step: 6, title: 'Asset Management', description: 'Trustee manages assets for growth and income. Can invest in real estate, alternative assets, or traditional investments.' },
                    { step: 7, title: 'Remainder Distribution', description: 'Upon surviving spouse\'s death, assets pass to remainder beneficiaries (typically children from first marriage) as specified in trust.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Income Only'],
                    specialFeatures: []
                }
            },
            dynasty: {
                name: 'Dynasty Trust',
                description: 'Multi-generational trust designed to last for multiple generations, avoiding estate taxes.',
                grantor: {
                    name: 'John (Founder)',
                    actions: ['Creates dynasty trust', 'Funds with assets', 'Uses GST exemption'],
                    assets: ['$13.61M (GST exemption)', 'Investment portfolio', 'Real estate', 'Family business']
                },
                trustee: {
                    name: 'Corporate Trustee or Family Office',
                    actions: ['Manages assets for generations', 'Distributes to beneficiaries', 'Preserves wealth'],
                    powers: ['Long-term investment strategy', 'Distribution discretion', 'Multi-generational planning']
                },
                beneficiary: {
                    name: 'Children, Grandchildren, Future Generations',
                    receives: ['Discretionary distributions', 'Education funding', 'Support payments'],
                    timing: 'Distributions as needed, assets preserved for future generations'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Perpetual (in some states)', 'GST exempt'],
                    taxBenefits: ['Generation-skipping tax exemption', 'Estate tax avoidance for generations']
                },
                flow: [
                    { step: 1, title: 'Trust Creation', description: 'Grantor creates dynasty trust and allocates GST exemption ($13.61M in 2024). Trust designed to last multiple generations.' },
                    { step: 2, title: 'Initial Funding', description: 'Grantor transfers assets to dynasty trust: investments, real estate, family business interests. Real estate requires professional valuation and deed transfer.' },
                    { step: 3, title: 'GST Exemption Allocation', description: 'Grantor allocates GST exemption to trust, protecting it from generation-skipping transfer tax for all future generations.' },
                    { step: 4, title: 'Multi-Generational Management', description: 'Trustee manages assets with long-term perspective, investing in real estate, alternative assets, and growth investments for future generations.' },
                    { step: 5, title: 'Beneficiary Distributions', description: 'Trustee makes discretionary distributions to current beneficiaries (children, grandchildren) for education, health, maintenance, and support.' },
                    { step: 6, title: 'Wealth Preservation', description: 'Assets grow within trust, protected from estate taxes, generation-skipping taxes, and creditors for multiple generations.' },
                    { step: 7, title: 'Perpetual Growth', description: 'Trust continues for multiple generations (perpetual in some states), preserving family wealth and providing for future descendants.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Generation-Skipping'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: ['Generation-Skipping']
                }
            },
            clt: {
                name: 'Charitable Lead Trust (CLT)',
                description: 'Provides income to charity first, then remainder to beneficiaries.',
                grantor: {
                    name: 'John (Grantor)',
                    actions: ['Creates CLT', 'Transfers assets', 'Names charity as lead beneficiary'],
                    assets: ['$2M in assets', 'Investment portfolio', 'Real estate', 'Business interests']
                },
                trustee: {
                    name: 'Corporate Trustee',
                    actions: ['Manages assets', 'Pays income to charity', 'Distributes remainder to beneficiaries'],
                    powers: ['Investment management', 'Charitable payments', 'Remainder distribution']
                },
                beneficiary: {
                    name: 'Charity (Lead - Income) & Children (Remainder)',
                    receives: ['Charity: income stream (5-7% annually)', 'Children: remainder after term'],
                    timing: 'Charity receives income during term, children receive remainder'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Fixed charitable term', 'Remainder to family'],
                    taxBenefits: ['Charitable income tax deduction', 'Estate tax reduction', 'Gift tax savings']
                },
                flow: [
                    { step: 1, title: 'CLT Creation', description: 'Grantor creates irrevocable CLT with fixed term (e.g., 20 years) and names charity as lead beneficiary.' },
                    { step: 2, title: 'Asset Transfer', description: 'Grantor transfers assets to CLT: investments, real estate, business interests. Real estate requires valuation and deed transfer.' },
                    { step: 3, title: 'Charitable Deduction', description: 'Grantor receives immediate income tax deduction for present value of charitable income stream. Larger deduction with longer terms.' },
                    { step: 4, title: 'Charitable Payments', description: 'Trustee pays fixed percentage (5-7%) of trust value to charity annually. Payments can be funded by rental income, dividends, or asset sales.' },
                    { step: 5, title: 'Asset Growth', description: 'Assets grow within CLT during charitable term. Real estate and alternative assets can appreciate, increasing remainder value.' },
                    { step: 6, title: 'Term Completion', description: 'After charitable term ends, all remaining assets (including appreciation) pass to remainder beneficiaries (typically children).' },
                    { step: 7, title: 'Tax Benefits', description: 'Grantor receives charitable deduction, reduces estate tax, and transfers remainder to children with minimal gift tax exposure.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Charitable Deduction'],
                    primaryPurpose: ['Charitable Giving', 'Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Charitable Remainder'],
                    specialFeatures: []
                }
            },
            qprt: {
                name: 'Qualified Personal Residence Trust (QPRT)',
                description: 'Transfers primary residence or vacation home to beneficiaries at reduced gift tax value.',
                grantor: {
                    name: 'John (Grantor)',
                    actions: ['Creates QPRT', 'Transfers residence', 'Retains use during term'],
                    assets: ['Primary residence ($1.5M)', 'Vacation home ($800K)', 'Personal property']
                },
                trustee: {
                    name: 'Corporate Trustee or Family Member',
                    actions: ['Holds legal title', 'Manages property', 'Distributes after term'],
                    powers: ['Property management', 'Maintenance decisions', 'Distribution authority']
                },
                beneficiary: {
                    name: 'Children',
                    receives: ['Residence after term', 'Appreciation above discount'],
                    timing: 'After retained interest term (typically 10-15 years)'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Fixed term', 'Grantor retains use'],
                    taxBenefits: ['Gift tax discount', 'Estate tax exclusion', 'Appreciation transfer']
                },
                flow: [
                    { step: 1, title: 'QPRT Creation', description: 'Grantor creates irrevocable QPRT with fixed term (typically 10-15 years) and names children as remainder beneficiaries.' },
                    { step: 2, title: 'Residence Transfer', description: 'Grantor transfers residence to QPRT via deed. Can include primary residence, vacation home, or both (in separate QPRTs).' },
                    { step: 3, title: 'Valuation Discount', description: 'Gift value = full value minus present value of retained interest. Longer terms = larger discount (typically 30-50% reduction).' },
                    { step: 4, title: 'Retained Use', description: 'Grantor continues to live in residence rent-free during term. Must pay property taxes, insurance, and maintenance.' },
                    { step: 5, title: 'Term Completion', description: 'After term ends, residence transfers to children. If grantor wants to continue living there, must pay fair market rent.' },
                    { step: 6, title: 'Appreciation Benefit', description: 'All appreciation during term transfers to children tax-free. Particularly valuable in appreciating real estate markets.' },
                    { step: 7, title: 'Estate Exclusion', description: 'Residence and all appreciation excluded from grantor\'s estate, reducing estate tax liability significantly.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Gift Tax Exclusion'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Principal Access'],
                    specialFeatures: ['Real Estate']
                }
            },
            snt: {
                name: 'Special Needs Trust (SNT)',
                description: 'Preserves government benefits eligibility while providing supplemental support.',
                grantor: {
                    name: 'John (Parent)',
                    actions: ['Creates SNT', 'Funds with assets', 'Names disabled child as beneficiary'],
                    assets: ['$500K inheritance', 'Life insurance proceeds', 'Savings', 'Real estate']
                },
                trustee: {
                    name: 'Family Member or Professional Trustee',
                    actions: ['Manages trust assets', 'Makes supplemental distributions', 'Preserves benefits'],
                    powers: ['Distribution discretion', 'Benefit coordination', 'Asset management']
                },
                beneficiary: {
                    name: 'Disabled Child',
                    receives: ['Supplemental support', 'Quality of life enhancements', 'Not basic needs'],
                    timing: 'Distributions as needed, preserves SSI/Medicaid eligibility'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Supplemental needs only', 'Medicaid payback provision'],
                    taxBenefits: ['Preserves government benefits', 'Asset protection']
                },
                flow: [
                    { step: 1, title: 'SNT Creation', description: 'Parent creates special needs trust for disabled child. Can be first-party (child\'s assets) or third-party (parent\'s assets).' },
                    { step: 2, title: 'Trust Funding', description: 'Assets transferred to SNT: inheritance, life insurance, savings, or real estate. Real estate requires deed transfer and valuation.' },
                    { step: 3, title: 'Benefit Preservation', description: 'Trust structured to preserve SSI and Medicaid eligibility. Distributions must not duplicate government benefits.' },
                    { step: 4, title: 'Supplemental Distributions', description: 'Trustee makes distributions for supplemental needs: education, recreation, travel, technology, home improvements, not food or shelter.' },
                    { step: 5, title: 'Asset Management', description: 'Trustee manages assets to provide long-term support. Can invest in real estate, investments, or other assets for growth.' },
                    { step: 6, title: 'Lifetime Support', description: 'Trust provides supplemental support throughout beneficiary\'s lifetime, enhancing quality of life while preserving government benefits.' },
                    { step: 7, title: 'Medicaid Payback', description: 'Upon beneficiary\'s death, remaining assets may be subject to Medicaid payback (first-party SNT) or pass to other beneficiaries (third-party SNT).' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Special Needs'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                }
            },
            asset: {
                name: 'Asset Protection Trust',
                description: 'Shields assets from creditors while allowing grantor to be discretionary beneficiary.',
                grantor: {
                    name: 'John (Business Owner)',
                    actions: ['Creates trust', 'Transfers assets', 'Names self as discretionary beneficiary'],
                    assets: ['$2M in investments', 'Real estate', 'Business interests', 'Liquid assets']
                },
                trustee: {
                    name: 'Offshore Trustee or Domestic Trustee (DAPT)',
                    actions: ['Manages assets', 'Makes discretionary distributions', 'Protects from creditors'],
                    powers: ['Investment management', 'Distribution discretion', 'Creditor protection']
                },
                beneficiary: {
                    name: 'John (Discretionary) & Family',
                    receives: ['Discretionary distributions', 'Asset protection', 'Creditor shield'],
                    timing: 'Distributions as needed, assets protected from creditors'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Discretionary beneficiary', 'Spendthrift provisions'],
                    taxBenefits: ['Creditor protection', 'Asset shielding']
                },
                flow: [
                    { step: 1, title: 'Trust Creation', description: 'Grantor creates irrevocable asset protection trust. Can be domestic (DAPT in certain states) or offshore trust.' },
                    { step: 2, title: 'Asset Transfer', description: 'Grantor transfers assets to trust: investments, real estate, business interests. Real estate requires deed transfer and valuation.' },
                    { step: 3, title: 'Creditor Protection', description: 'Assets transferred to trust are protected from future creditors. Must be done before creditor claims arise (fraudulent transfer rules apply).' },
                    { step: 4, title: 'Discretionary Distributions', description: 'Trustee has discretion to distribute to grantor and family. Grantor cannot demand distributions, maintaining creditor protection.' },
                    { step: 5, title: 'Asset Management', description: 'Trustee manages assets for growth and protection. Can invest in real estate, alternative assets, or traditional investments.' },
                    { step: 6, title: 'Liability Shield', description: 'Trust assets protected from business liabilities, lawsuits, divorce, and other creditor claims. Particularly valuable for high-risk professions.' },
                    { step: 7, title: 'Long-Term Protection', description: 'Assets remain protected for grantor\'s lifetime and can pass to beneficiaries, maintaining creditor protection across generations.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Asset Protection'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                }
            },
            business: {
                name: 'Business Succession Trust',
                description: 'Facilitates transfer of business interests to next generation with tax efficiency.',
                grantor: {
                    name: 'John (Business Owner)',
                    actions: ['Creates trust', 'Transfers business interests', 'Plans succession'],
                    assets: ['Family business (100% ownership)', 'Real estate (business property)', 'Equipment', 'Intellectual property']
                },
                trustee: {
                    name: 'Corporate Trustee or Family Member',
                    actions: ['Manages business interests', 'Coordinates succession', 'Distributes to heirs'],
                    powers: ['Business management', 'Succession planning', 'Distribution discretion']
                },
                beneficiary: {
                    name: 'Children (Successors)',
                    receives: ['Business interests', 'Ownership over time', 'Management training'],
                    timing: 'Gradual transfer during lifetime or at death'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Business succession plan', 'Valuation discounts'],
                    taxBenefits: ['Estate tax reduction', 'Valuation discounts', 'Tax-efficient transfer']
                },
                flow: [
                    { step: 1, title: 'Trust Creation', description: 'Business owner creates irrevocable trust and develops succession plan for transferring business to next generation.' },
                    { step: 2, title: 'Business Valuation', description: 'Business valued for transfer purposes. Can use valuation discounts for lack of marketability and minority interests (typically 20-40% discount).' },
                    { step: 3, title: 'Interest Transfer', description: 'Business interests transferred to trust: ownership shares, real estate, equipment, intellectual property. Real estate requires deed transfer.' },
                    { step: 4, title: 'Gift Tax Planning', description: 'Transfer structured to minimize gift tax using annual exclusions, valuation discounts, and exemption amounts.' },
                    { step: 5, title: 'Succession Management', description: 'Trustee manages business interests and coordinates succession. Can provide management training and gradual ownership transfer.' },
                    { step: 6, title: 'Business Continuity', description: 'Business continues operating under trust ownership. Real estate and business assets managed for long-term success.' },
                    { step: 7, title: 'Heir Transfer', description: 'Business interests gradually or fully transfer to children, maintaining business continuity while minimizing estate tax.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction'],
                    primaryPurpose: ['Business Succession', 'Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: ['Business Interests']
                }
            },
            gst: {
                name: 'Generation-Skipping Trust (GST)',
                description: 'Transfers assets to grandchildren or later generations, skipping estate tax on children.',
                grantor: {
                    name: 'John (Grandparent)',
                    actions: ['Creates GST trust', 'Funds with assets', 'Allocates GST exemption'],
                    assets: ['$13.61M (GST exemption)', 'Investment portfolio', 'Real estate', 'Family wealth']
                },
                trustee: {
                    name: 'Corporate Trustee or Family Member',
                    actions: ['Manages assets', 'Distributes to grandchildren', 'Skips children\'s generation'],
                    powers: ['Investment management', 'Distribution discretion', 'Multi-generational planning']
                },
                beneficiary: {
                    name: 'Grandchildren & Future Generations',
                    receives: ['Discretionary distributions', 'Education funding', 'Support payments'],
                    timing: 'Distributions as needed, skips children\'s generation for tax purposes'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'GST exempt', 'Generation-skipping structure'],
                    taxBenefits: ['GST exemption', 'Skips generation tax', 'Multi-generational planning']
                },
                flow: [
                    { step: 1, title: 'GST Trust Creation', description: 'Grandparent creates generation-skipping trust and allocates GST exemption ($13.61M in 2024) to protect transfers from GST tax.' },
                    { step: 2, title: 'Asset Transfer', description: 'Assets transferred to GST trust: investments, real estate, family wealth. Real estate requires valuation and deed transfer.' },
                    { step: 3, title: 'GST Exemption Allocation', description: 'Grantor allocates GST exemption to trust, protecting all future distributions from 40% generation-skipping transfer tax.' },
                    { step: 4, title: 'Generation Skip', description: 'Trust structured to skip children\'s generation for tax purposes, transferring directly to grandchildren and beyond.' },
                    { step: 5, title: 'Beneficiary Distributions', description: 'Trustee makes discretionary distributions to grandchildren for education, health, maintenance, and support, bypassing children\'s estate.' },
                    { step: 6, title: 'Tax Avoidance', description: 'Assets avoid estate tax in children\'s generation, transferring directly to grandchildren. All appreciation also transfers tax-free.' },
                    { step: 7, title: 'Multi-Generational Wealth', description: 'Trust preserves wealth for multiple generations, providing for grandchildren and future descendants while minimizing transfer taxes.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Generation-Skipping', 'Estate Tax Reduction'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: ['Generation-Skipping']
                }
            },
            idgt: {
                name: 'Intentionally Defective Grantor Trust (IDGT)',
                description: 'Grantor pays income tax but trust assets excluded from estate, creating tax-free growth.',
                grantor: {
                    name: 'John (Grantor)',
                    actions: ['Creates IDGT', 'Transfers assets', 'Pays income taxes'],
                    assets: ['$5M in assets', 'Investment portfolio', 'Real estate', 'Business interests']
                },
                trustee: {
                    name: 'Corporate Trustee or Family Member',
                    actions: ['Manages assets', 'Distributes to beneficiaries', 'Coordinates tax payments'],
                    powers: ['Investment management', 'Distribution discretion', 'Tax coordination']
                },
                beneficiary: {
                    name: 'Children',
                    receives: ['Trust distributions', 'Tax-free growth', 'Estate-excluded assets'],
                    timing: 'Distributions as needed, assets excluded from grantor\'s estate'
                },
                trustAgreement: {
                    terms: ['Irrevocable', 'Grantor trust status', 'Estate exclusion'],
                    taxBenefits: ['Estate exclusion', 'Grantor pays taxes', 'Tax-free growth']
                },
                flow: [
                    { step: 1, title: 'IDGT Creation', description: 'Grantor creates intentionally defective grantor trust. Trust is "defective" for income tax (grantor pays) but "complete" for estate tax (excluded).' },
                    { step: 2, title: 'Asset Transfer', description: 'Grantor transfers assets to IDGT: investments, real estate, business interests. Real estate requires valuation and deed transfer.' },
                    { step: 3, title: 'Estate Exclusion', description: 'Assets immediately excluded from grantor\'s estate for estate tax purposes, even though grantor pays income taxes.' },
                    { step: 4, title: 'Grantor Tax Payment', description: 'Grantor pays all income taxes on trust income and gains. This is effectively a tax-free gift to beneficiaries (taxes reduce grantor\'s estate).' },
                    { step: 5, title: 'Tax-Free Growth', description: 'Assets grow within IDGT without income tax burden on trust. All growth benefits beneficiaries without reducing grantor\'s estate further.' },
                    { step: 6, title: 'Beneficiary Distributions', description: 'Trustee makes distributions to children as needed. Distributions are income tax-free to beneficiaries (grantor already paid taxes).' },
                    { step: 7, title: 'Estate Tax Savings', description: 'Upon grantor\'s death, all IDGT assets (including all growth) pass to beneficiaries free of estate tax, while grantor\'s estate was reduced by taxes paid.' }
                ],
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Income Tax Planning'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                }
            }
        };

        let currentExample = 'revocable';

        function renderTrustDiagram() {
            const example = TRUST_EXAMPLES[currentExample];
            const diagram = document.getElementById('trustDiagram');
            
            // Create Mermaid flowchart syntax
            const grantorLabel = example.grantor.name.replace(/'/g, "''");
            const trusteeLabel = example.trustee.name.replace(/'/g, "''");
            const beneficiaryLabel = example.beneficiary.name.replace(/'/g, "''");
            const trustName = example.name.replace(/'/g, "''");
            
            const mermaidCode = `
flowchart TD
    A["üë§ ${grantorLabel}<br/>Grantor"] -->|"Transfers Assets"| B["üìú Trust Agreement<br/>${trustName}"]
    B -->|"Management Authority"| C["‚öñÔ∏è ${trusteeLabel}<br/>Trustee"]
    B -->|"Distributions"| D["üë• ${beneficiaryLabel}<br/>Beneficiary"]
    C -.->|"Manages For"| D
    
    style A fill:#1e3a8a,stroke:#3b82f6,stroke-width:3px,color:#f8fafc
    style B fill:#581c87,stroke:#8b5cf6,stroke-width:3px,color:#f8fafc
    style C fill:#164e63,stroke:#06b6d4,stroke-width:3px,color:#f8fafc
    style D fill:#065f46,stroke:#10b981,stroke-width:3px,color:#f8fafc
            `.trim();
            
            // Create unique ID for this diagram
            const diagramId = `mermaid-diagram-${currentExample}-${Date.now()}`;
            
            diagram.innerHTML = `
                <div class="mermaid-container bg-slate-900/50 p-6 rounded-xl" style="min-height: 400px;">
                    <div class="mermaid" id="${diagramId}">${mermaidCode}</div>
                </div>
            `;
            
            // Render Mermaid diagram
            if (window.mermaid) {
                window.mermaid.run({
                    nodes: [document.getElementById(diagramId)]
                }).then(() => {
                    // Diagram rendered successfully
                }).catch(err => {
                    console.error('Mermaid rendering error:', err);
                    // Fallback to simple text display
                    diagram.innerHTML = `
                        <div class="bg-slate-800 p-6 rounded-xl">
                            <p class="text-red-400">Error rendering diagram. Please refresh the page.</p>
                        </div>
                    `;
                });
            } else {
                // Mermaid not loaded yet, wait a bit and try again
                setTimeout(() => {
                    if (window.mermaid) {
                        window.mermaid.run({
                            nodes: [document.getElementById(diagramId)]
                        });
                    }
                }, 500);
            }
        }

        function renderModuleBreakdown() {
            const example = TRUST_EXAMPLES[currentExample];
            const container = document.getElementById('moduleBreakdown');
            container.innerHTML = '';

            Object.entries(example.modules).forEach(([category, modules]) => {
                if (modules.length === 0) return;
                
                const categoryInfo = {
                    revocability: { name: 'Revocability', color: 'blue' },
                    taxTreatment: { name: 'Tax Treatment', color: 'purple' },
                    primaryPurpose: { name: 'Primary Purpose', color: 'cyan' },
                    control: { name: 'Control Structure', color: 'pink' },
                    distribution: { name: 'Distribution Method', color: 'emerald' },
                    specialFeatures: { name: 'Special Features', color: 'yellow' }
                };

                const info = categoryInfo[category];
                const colorMap = {
                    blue: 'border-blue-500 bg-blue-500/10',
                    purple: 'border-purple-500 bg-purple-500/10',
                    cyan: 'border-cyan-500 bg-cyan-500/10',
                    pink: 'border-pink-500 bg-pink-500/10',
                    emerald: 'border-emerald-500 bg-emerald-500/10',
                    yellow: 'border-yellow-500 bg-yellow-500/10'
                };

                const card = document.createElement('div');
                card.className = `bg-slate-800 p-4 rounded-lg border-l-4 ${colorMap[info.color]}`;
                card.innerHTML = `
                    <h4 class="font-bold text-white mb-2">${info.name}</h4>
                    <div class="space-y-1">
                        ${modules.map(m => `<div class="text-sm text-slate-300">‚Ä¢ ${m}</div>`).join('')}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderFlowExplanation() {
            const example = TRUST_EXAMPLES[currentExample];
            const container = document.getElementById('flowExplanation');
            container.innerHTML = '';

            example.flow.forEach((step, index) => {
                const stepDiv = document.createElement('div');
                stepDiv.className = 'flow-step';
                stepDiv.innerHTML = `
                    <div class="flow-step-badge">${step.step}</div>
                    <div class="flow-connector"></div>
                    <div class="flow-step-content">
                        <h4 class="flow-step-title">${step.title}</h4>
                        <p class="flow-step-description">${step.description}</p>
                    </div>
                `;
                container.appendChild(stepDiv);
            });
        }

        function updateExample() {
            const select = document.getElementById('trustExampleSelect');
            currentExample = select.value;
            const example = TRUST_EXAMPLES[currentExample];
            
            // Update description
            const descEl = document.getElementById('trustDescription');
            if (descEl) {
                descEl.textContent = example.description;
            }
            
            renderTrustDiagram();
            renderModuleBreakdown();
            renderFlowExplanation();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            const select = document.getElementById('trustExampleSelect');
            if (select) {
                select.addEventListener('change', updateExample);
                updateExample();
            }
        });

        // ----------------------------------------------------
        // Trust Types Database with Modular Categorization
        // ----------------------------------------------------

        // Define Module Categories
        const MODULE_CATEGORIES = {
            revocability: {
                name: 'Revocability',
                color: 'blue',
                options: ['Revocable', 'Irrevocable']
            },
            taxTreatment: {
                name: 'Tax Treatment',
                color: 'purple',
                options: ['Estate Tax Reduction', 'Income Tax Planning', 'Gift Tax Exclusion', 'Generation-Skipping', 'Charitable Deduction']
            },
            primaryPurpose: {
                name: 'Primary Purpose',
                color: 'cyan',
                options: ['Estate Planning', 'Asset Protection', 'Charitable Giving', 'Business Succession', 'Special Needs', 'Life Insurance Planning']
            },
            control: {
                name: 'Control Structure',
                color: 'pink',
                options: ['Grantor Retains Control', 'Trustee Discretion', 'Beneficiary Control', 'Limited Control']
            },
            distribution: {
                name: 'Distribution Method',
                color: 'green',
                options: ['Income Only', 'Principal Access', 'Discretionary', 'Mandatory', 'Charitable Remainder']
            },
            specialFeatures: {
                name: 'Special Features',
                color: 'yellow',
                options: ['Life Insurance', 'Real Estate', 'Business Interests', 'Medicaid Planning', 'Generation-Skipping']
            }
        };

        // Comprehensive Trust Types Database
        const TRUST_TYPES = [
            {
                name: 'Revocable Living Trust',
                description: 'The most common trust for avoiding probate while maintaining full control during lifetime.',
                modules: {
                    revocability: ['Revocable'],
                    taxTreatment: ['Estate Tax Reduction'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                },
                keyFeatures: 'Avoids probate, maintains control, can be modified anytime'
            },
            {
                name: 'Irrevocable Life Insurance Trust (ILIT)',
                description: 'Removes life insurance from estate while providing liquidity to beneficiaries.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Gift Tax Exclusion'],
                    primaryPurpose: ['Life Insurance Planning', 'Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: ['Life Insurance']
                },
                keyFeatures: 'Removes insurance from estate, provides tax-free death benefit'
            },
            {
                name: 'Grantor Retained Annuity Trust (GRAT)',
                description: 'Transfers appreciating assets to beneficiaries with minimal gift tax exposure.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Gift Tax Exclusion'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Mandatory'],
                    specialFeatures: []
                },
                keyFeatures: 'Freezes asset value, transfers appreciation tax-free'
            },
            {
                name: 'Charitable Remainder Trust (CRT)',
                description: 'Provides income to beneficiaries with remainder going to charity, generating tax deduction.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Income Tax Planning', 'Charitable Deduction'],
                    primaryPurpose: ['Charitable Giving', 'Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Income Only', 'Charitable Remainder'],
                    specialFeatures: []
                },
                keyFeatures: 'Charitable deduction, income stream, estate tax reduction'
            },
            {
                name: 'Charitable Lead Trust (CLT)',
                description: 'Provides income to charity first, then remainder to beneficiaries.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Charitable Deduction'],
                    primaryPurpose: ['Charitable Giving', 'Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Charitable Remainder'],
                    specialFeatures: []
                },
                keyFeatures: 'Charitable income stream, reduces estate tax, remainder to heirs'
            },
            {
                name: 'Qualified Personal Residence Trust (QPRT)',
                description: 'Transfers primary residence or vacation home to beneficiaries at reduced gift tax value.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Gift Tax Exclusion'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Principal Access'],
                    specialFeatures: ['Real Estate']
                },
                keyFeatures: 'Transfers home at discounted value, grantor retains use'
            },
            {
                name: 'Dynasty Trust',
                description: 'Multi-generational trust designed to last for multiple generations, avoiding estate taxes.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Generation-Skipping'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: ['Generation-Skipping']
                },
                keyFeatures: 'Multi-generational, GST tax exemption, asset protection'
            },
            {
                name: 'Asset Protection Trust',
                description: 'Shields assets from creditors while allowing grantor to be discretionary beneficiary.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Asset Protection'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                },
                keyFeatures: 'Creditor protection, spendthrift provisions, offshore options'
            },
            {
                name: 'Special Needs Trust (SNT)',
                description: 'Preserves government benefits eligibility while providing supplemental support.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Special Needs'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                },
                keyFeatures: 'Preserves SSI/Medicaid eligibility, supplemental support'
            },
            {
                name: 'Spendthrift Trust',
                description: 'Protects trust assets from beneficiary creditors and poor financial decisions.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Asset Protection'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                },
                keyFeatures: 'Creditor protection, controlled distributions, beneficiary protection'
            },
            {
                name: 'Bypass Trust (Credit Shelter Trust)',
                description: 'Maximizes estate tax exemption by utilizing both spouses\' exemptions.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Income Only', 'Principal Access'],
                    specialFeatures: []
                },
                keyFeatures: 'Doubles estate tax exemption, provides for surviving spouse'
            },
            {
                name: 'QTIP Trust (Qualified Terminable Interest Property)',
                description: 'Provides income to surviving spouse while controlling ultimate distribution.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Income Only'],
                    specialFeatures: []
                },
                keyFeatures: 'Marital deduction, controls ultimate beneficiaries, income to spouse'
            },
            {
                name: 'Generation-Skipping Trust (GST)',
                description: 'Transfers assets to grandchildren or later generations, skipping estate tax on children.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Generation-Skipping', 'Estate Tax Reduction'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: ['Generation-Skipping']
                },
                keyFeatures: 'Skips generation, GST exemption, multi-generational planning'
            },
            {
                name: 'Intentionally Defective Grantor Trust (IDGT)',
                description: 'Grantor pays income tax but trust assets excluded from estate, creating tax-free growth.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction', 'Income Tax Planning'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                },
                keyFeatures: 'Estate exclusion, grantor pays taxes, tax-free growth'
            },
            {
                name: 'Business Succession Trust',
                description: 'Facilitates transfer of business interests to next generation with tax efficiency.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction'],
                    primaryPurpose: ['Business Succession', 'Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: ['Business Interests']
                },
                keyFeatures: 'Business continuity, valuation discounts, tax-efficient transfer'
            },
            {
                name: 'Medicaid Asset Protection Trust',
                description: 'Shields assets to qualify for Medicaid while preserving wealth for heirs.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: ['Medicaid Planning']
                },
                keyFeatures: 'Medicaid eligibility, 5-year lookback, asset preservation'
            },
            {
                name: 'Pet Trust',
                description: 'Provides for care of pets after owner\'s death or incapacity.',
                modules: {
                    revocability: ['Revocable', 'Irrevocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Mandatory'],
                    specialFeatures: []
                },
                keyFeatures: 'Pet care funding, enforceable care standards, trustee oversight'
            },
            {
                name: 'Totten Trust (Payable-on-Death)',
                description: 'Simple bank account trust that transfers to beneficiary upon death.',
                modules: {
                    revocability: ['Revocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Principal Access'],
                    specialFeatures: []
                },
                keyFeatures: 'Simple setup, avoids probate, revocable anytime'
            },
            {
                name: 'Testamentary Trust',
                description: 'Created by will, becomes active only after grantor\'s death.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                },
                keyFeatures: 'Created by will, probate required, post-death activation'
            },
            {
                name: 'Marital Trust',
                description: 'Provides for surviving spouse with estate tax benefits.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Estate Tax Reduction'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Income Only', 'Principal Access'],
                    specialFeatures: []
                },
                keyFeatures: 'Marital deduction, spouse benefits, estate tax deferral'
            },
            {
                name: 'Crummey Trust',
                description: 'Allows annual gift tax exclusion while maintaining trust structure.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Gift Tax Exclusion'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                },
                keyFeatures: 'Annual exclusion gifts, withdrawal rights, trust accumulation'
            },
            {
                name: 'Rabbi Trust',
                description: 'Non-qualified deferred compensation trust for executives.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Income Tax Planning'],
                    primaryPurpose: ['Business Succession'],
                    control: ['Trustee Discretion'],
                    distribution: ['Mandatory'],
                    specialFeatures: []
                },
                keyFeatures: 'Executive compensation, unfunded promise, creditor protection'
            },
            {
                name: 'Land Trust',
                description: 'Holds real estate with privacy and simplified transfer.',
                modules: {
                    revocability: ['Revocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Estate Planning', 'Asset Protection'],
                    control: ['Grantor Retains Control'],
                    distribution: ['Principal Access'],
                    specialFeatures: ['Real Estate']
                },
                keyFeatures: 'Privacy, easy transfer, real estate holding'
            },
            {
                name: 'Delaware Statutory Trust (DST)',
                description: 'Investment vehicle for 1031 exchanges and fractional real estate ownership.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: ['Income Tax Planning'],
                    primaryPurpose: ['Estate Planning'],
                    control: ['Trustee Discretion'],
                    distribution: ['Income Only'],
                    specialFeatures: ['Real Estate']
                },
                keyFeatures: '1031 exchange eligible, fractional ownership, passive income'
            },
            {
                name: 'Domestic Asset Protection Trust (DAPT)',
                description: 'Self-settled trust providing creditor protection in certain states.',
                modules: {
                    revocability: ['Irrevocable'],
                    taxTreatment: [],
                    primaryPurpose: ['Asset Protection'],
                    control: ['Trustee Discretion'],
                    distribution: ['Discretionary'],
                    specialFeatures: []
                },
                keyFeatures: 'Self-settled, state-specific, creditor protection'
            }
        ];

        // Flatten all modules for filtering
        const ALL_MODULES = [];
        Object.values(MODULE_CATEGORIES).forEach(category => {
            category.options.forEach(option => {
                if (!ALL_MODULES.includes(option)) {
                    ALL_MODULES.push(option);
                }
            });
        });

        // Initialize Trust Types Display
        let filteredTrusts = [...TRUST_TYPES];
        let selectedModules = [];

        function renderTrustTypes() {
            const container = document.getElementById('trustTypesContainer');
            container.innerHTML = '';

            if (filteredTrusts.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center text-slate-400 py-8">No trusts match your search criteria.</div>';
                return;
            }

            filteredTrusts.forEach(trust => {
                const card = document.createElement('div');
                card.className = 'glass-panel p-6 rounded-xl hover:border-blue-500 transition border border-slate-700';
                
                // Get all modules for this trust
                const trustModules = [];
                Object.values(trust.modules).forEach(moduleArray => {
                    moduleArray.forEach(mod => trustModules.push(mod));
                });

                // Create module badges with proper color mapping
                const moduleBadges = trustModules.map(module => {
                    const category = Object.values(MODULE_CATEGORIES).find(cat => cat.options.includes(module));
                    let colorClass = 'bg-slate-500/20 text-slate-400 border-slate-500/30';
                    if (category) {
                        const colorMap = {
                            blue: 'bg-blue-500/20 text-blue-400 border-blue-500/30',
                            purple: 'bg-purple-500/20 text-purple-400 border-purple-500/30',
                            cyan: 'bg-cyan-500/20 text-cyan-400 border-cyan-500/30',
                            pink: 'bg-pink-500/20 text-pink-400 border-pink-500/30',
                            green: 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30',
                            yellow: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30'
                        };
                        colorClass = colorMap[category.color] || colorClass;
                    }
                    return `<span class="px-2 py-1 text-xs rounded-full ${colorClass} border">${module}</span>`;
                }).join(' ');

                card.innerHTML = `
                    <div class="flex justify-between items-start mb-3">
                        <h3 class="text-lg font-bold text-white">${trust.name}</h3>
                        <button onclick="toggleComparison('${trust.name}')" class="text-xs px-2 py-1 rounded bg-slate-700 hover:bg-slate-600 text-slate-300">Compare</button>
                    </div>
                    <p class="text-sm text-slate-400 mb-4">${trust.description}</p>
                    <div class="mb-4">
                        <p class="text-xs font-semibold text-slate-300 mb-2">Key Features:</p>
                        <p class="text-xs text-slate-400">${trust.keyFeatures}</p>
                    </div>
                    <div class="flex flex-wrap gap-2">
                        ${moduleBadges}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function renderModuleStats() {
            const statsContainer = document.getElementById('moduleStats');
            statsContainer.innerHTML = '';

            // Count how many trusts have each module
            const moduleCounts = {};
            ALL_MODULES.forEach(module => {
                moduleCounts[module] = TRUST_TYPES.filter(trust => {
                    return Object.values(trust.modules).some(moduleArray => moduleArray.includes(module));
                }).length;
            });

            // Sort by count descending
            const sortedModules = Object.entries(moduleCounts).sort((a, b) => b[1] - a[1]);

            sortedModules.forEach(([module, count]) => {
                const statCard = document.createElement('div');
                statCard.className = 'bg-slate-800 p-3 rounded-lg border border-slate-700';
                statCard.innerHTML = `
                    <div class="text-xs text-slate-400 mb-1">${module}</div>
                    <div class="text-2xl font-bold text-cyan-400">${count}</div>
                    <div class="text-xs text-slate-500">of ${TRUST_TYPES.length} trusts</div>
                `;
                statCard.onclick = () => showModuleTrusts(module);
                statCard.className += ' cursor-pointer hover:border-cyan-500 transition';
                statsContainer.appendChild(statCard);
            });
        }

        let currentModalModule = null;

        function showModuleTrusts(module) {
            currentModalModule = module;
            const modal = document.getElementById('moduleTrustsModal');
            const moduleNameEl = document.getElementById('modalModuleName');
            const moduleCountEl = document.getElementById('modalModuleCount');
            const trustListEl = document.getElementById('modalTrustList');

            // Get all trusts that use this module
            const trustsWithModule = TRUST_TYPES.filter(trust => {
                const trustModules = [];
                Object.values(trust.modules).forEach(moduleArray => {
                    moduleArray.forEach(mod => trustModules.push(mod));
                });
                return trustModules.includes(module);
            });

            // Update modal header
            moduleNameEl.textContent = module;
            moduleCountEl.textContent = `${trustsWithModule.length} of ${TRUST_TYPES.length} trust types use this module`;

            // Populate trust list
            trustListEl.innerHTML = '';
            if (trustsWithModule.length === 0) {
                trustListEl.innerHTML = '<p class="text-slate-400 text-center py-8">No trust types use this module.</p>';
            } else {
                trustsWithModule.forEach(trust => {
                    const trustItem = document.createElement('div');
                    trustItem.className = 'bg-slate-800/50 p-4 rounded-lg border border-slate-700 mb-3 hover:border-cyan-500 transition cursor-pointer';
                    trustItem.onclick = () => {
                        // Scroll to trust in the grid
                        scrollToTrust(trust.name);
                        closeModuleModal();
                    };
                    
                    // Get all modules for this trust
                    const trustModules = [];
                    Object.values(trust.modules).forEach(moduleArray => {
                        moduleArray.forEach(mod => trustModules.push(mod));
                    });

                    trustItem.innerHTML = `
                        <h4 class="font-bold text-white mb-2">${trust.name}</h4>
                        <p class="text-sm text-slate-400 mb-3">${trust.description}</p>
                        <div class="flex flex-wrap gap-2">
                            ${trustModules.map(mod => {
                                const isHighlighted = mod === module;
                                return `<span class="px-2 py-1 text-xs rounded-full ${isHighlighted ? 'bg-cyan-500/30 text-cyan-300 border-cyan-500' : 'bg-slate-700/50 text-slate-400 border-slate-600'} border">${mod}</span>`;
                            }).join('')}
                        </div>
                    `;
                    trustListEl.appendChild(trustItem);
                });
            }

            // Show modal
            modal.classList.remove('hidden');
            modal.style.display = 'flex';
            modal.classList.add('items-center', 'justify-center');
        }

        function closeModuleModal() {
            const modal = document.getElementById('moduleTrustsModal');
            modal.classList.add('hidden');
            modal.style.display = 'none';
            modal.classList.remove('items-center', 'justify-center');
            currentModalModule = null;
        }

        function applyModuleFilterFromModal() {
            if (currentModalModule) {
                filterByModule(currentModalModule);
                closeModuleModal();
            }
        }

        function scrollToTrust(trustName) {
            // Find the trust card in the grid and scroll to it
            const container = document.getElementById('trustTypesContainer');
            const cards = container.querySelectorAll('[class*="glass-panel"]');
            cards.forEach(card => {
                const heading = card.querySelector('h3');
                if (heading && heading.textContent === trustName) {
                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    // Add a highlight effect
                    card.classList.add('ring-2', 'ring-cyan-500');
                    setTimeout(() => {
                        card.classList.remove('ring-2', 'ring-cyan-500');
                    }, 2000);
                }
            });
        }

        // Close modal when clicking outside
        document.addEventListener('click', (e) => {
            const modal = document.getElementById('moduleTrustsModal');
            if (e.target === modal) {
                closeModuleModal();
            }
        });

        // Close modal with Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModuleModal();
            }
        });

        function filterByModule(module) {
            if (selectedModules.includes(module)) {
                selectedModules = selectedModules.filter(m => m !== module);
            } else {
                if (!selectedModules.includes(module)) {
                    selectedModules.push(module);
                }
            }
            // Update checkbox state
            const checkbox = document.querySelector(`#moduleFilterContainer input[value="${module}"]`);
            if (checkbox) {
                checkbox.checked = selectedModules.includes(module);
            }
            applyFilters();
        }

        function applyFilters() {
            const searchTerm = document.getElementById('trustSearch').value.toLowerCase();

            filteredTrusts = TRUST_TYPES.filter(trust => {
                // Text search
                const matchesSearch = !searchTerm || 
                    trust.name.toLowerCase().includes(searchTerm) ||
                    trust.description.toLowerCase().includes(searchTerm) ||
                    trust.keyFeatures.toLowerCase().includes(searchTerm);

                // Module filter
                let matchesModules = true;
                if (selectedModules.length > 0) {
                    const trustModules = [];
                    Object.values(trust.modules).forEach(moduleArray => {
                        moduleArray.forEach(mod => trustModules.push(mod));
                    });
                    matchesModules = selectedModules.every(selectedMod => trustModules.includes(selectedMod));
                }

                return matchesSearch && matchesModules;
            });

            renderTrustTypes();
            updateActiveFilters();
        }

        function updateActiveFilters() {
            const activeFiltersContainer = document.getElementById('activeFilters');
            activeFiltersContainer.innerHTML = '';

            if (selectedModules.length > 0) {
                selectedModules.forEach(module => {
                    const badge = document.createElement('span');
                    badge.className = 'px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full text-xs border border-blue-500/30 flex items-center gap-2';
                    badge.innerHTML = `${module} <button onclick="removeFilter('${module}')" class="hover:text-blue-300">√ó</button>`;
                    activeFiltersContainer.appendChild(badge);
                });
            }
        }

        function removeFilter(module) {
            selectedModules = selectedModules.filter(m => m !== module);
            applyFilters();
        }

        // Populate module filter checkboxes
        function populateModuleFilter() {
            const container = document.getElementById('moduleFilterContainer');
            ALL_MODULES.sort().forEach(module => {
                const checkbox = document.createElement('label');
                checkbox.className = 'flex items-center gap-2 px-3 py-1 bg-slate-700 hover:bg-slate-600 rounded-lg cursor-pointer text-xs text-slate-300 border border-slate-600';
                checkbox.innerHTML = `
                    <input type="checkbox" value="${module}" class="rounded" onchange="handleModuleCheckbox('${module}', this.checked)">
                    <span>${module}</span>
                `;
                container.appendChild(checkbox);
            });
        }

        window.handleModuleCheckbox = function(module, checked) {
            if (checked) {
                if (!selectedModules.includes(module)) {
                    selectedModules.push(module);
                }
            } else {
                selectedModules = selectedModules.filter(m => m !== module);
            }
            applyFilters();
        };

        // Make filterByModule available globally
        window.filterByModule = filterByModule;
        window.closeModuleModal = closeModuleModal;
        window.applyModuleFilterFromModal = applyModuleFilterFromModal;

        // Glossary toggle function
        window.toggleGlossary = function() {
            const content = document.getElementById('glossaryContent');
            const toggleText = document.getElementById('glossaryToggleText');
            if (content.classList.contains('hidden')) {
                content.classList.remove('hidden');
                toggleText.textContent = 'Hide';
            } else {
                content.classList.add('hidden');
                toggleText.textContent = 'Show';
            }
        };

        // Comparison functionality
        let comparisonTrusts = [];

        window.toggleComparison = function(trustName) {
            const trust = TRUST_TYPES.find(t => t.name === trustName);
            if (!trust) return;

            const index = comparisonTrusts.findIndex(t => t.name === trustName);
            if (index > -1) {
                comparisonTrusts.splice(index, 1);
            } else {
                if (comparisonTrusts.length < 3) {
                    comparisonTrusts.push(trust);
                } else {
                    alert('Maximum 3 trusts can be compared at once.');
                    return;
                }
            }

            renderComparison();
        };

        function renderComparison() {
            const comparisonView = document.getElementById('comparisonView');
            const comparisonTable = document.getElementById('comparisonTable');

            if (comparisonTrusts.length === 0) {
                comparisonView.classList.add('hidden');
                return;
            }

            comparisonView.classList.remove('hidden');

            // Get all unique modules across compared trusts
            const allModules = new Set();
            comparisonTrusts.forEach(trust => {
                Object.values(trust.modules).forEach(moduleArray => {
                    moduleArray.forEach(mod => allModules.add(mod));
                });
            });

            let tableHTML = `
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b border-slate-700">
                            <th class="text-left p-3 text-slate-300">Feature</th>
                            ${comparisonTrusts.map(t => `<th class="text-left p-3 text-slate-300">${t.name}</th>`).join('')}
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="border-b border-slate-800">
                            <td class="p-3 font-semibold text-slate-200">Description</td>
                            ${comparisonTrusts.map(t => `<td class="p-3 text-slate-400">${t.description}</td>`).join('')}
                        </tr>
                        <tr class="border-b border-slate-800">
                            <td class="p-3 font-semibold text-slate-200">Key Features</td>
                            ${comparisonTrusts.map(t => `<td class="p-3 text-slate-400">${t.keyFeatures}</td>`).join('')}
                        </tr>
            `;

            // Add module rows
            Array.from(allModules).sort().forEach(module => {
                tableHTML += `
                    <tr class="border-b border-slate-800">
                        <td class="p-3 text-slate-300">${module}</td>
                        ${comparisonTrusts.map(trust => {
                            const hasModule = Object.values(trust.modules).some(moduleArray => moduleArray.includes(module));
                            return `<td class="p-3 text-center">${hasModule ? '<span class="text-green-400">‚úì</span>' : '<span class="text-slate-600">‚Äî</span>'}</td>`;
                        }).join('')}
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
                <button onclick="clearComparison()" class="mt-4 px-4 py-2 bg-slate-700 hover:bg-slate-600 rounded-lg text-sm text-slate-300">Clear Comparison</button>
            `;

            comparisonTable.innerHTML = tableHTML;
        }

        window.clearComparison = function() {
            comparisonTrusts = [];
            renderComparison();
        };

        // MVP Module Analysis
        function renderMVPAnalysis() {
            const container = document.getElementById('mvpAnalysis');
            if (!container) return;

            // Count how many trusts have each module
            const moduleCounts = {};
            ALL_MODULES.forEach(module => {
                moduleCounts[module] = TRUST_TYPES.filter(trust => {
                    return Object.values(trust.modules).some(moduleArray => moduleArray.includes(module));
                }).length;
            });

            // Sort by count descending
            const sortedModules = Object.entries(moduleCounts).sort((a, b) => b[1] - a[1]);
            const totalTrusts = TRUST_TYPES.length;

            // Top 8 modules = MVP
            const mvpModules = sortedModules.slice(0, 8).map(([module]) => module);

            // Calculate coverage at different module counts
            const coverageLevels = [
                { name: 'MVP (Top 8 Modules)', count: 8, modules: mvpModules },
                { name: 'Top 10 Modules', count: 10, modules: sortedModules.slice(0, 10).map(([m]) => m) },
                { name: 'Top 15 Modules', count: 15, modules: sortedModules.slice(0, 15).map(([m]) => m) },
                { name: 'All Modules', count: sortedModules.length, modules: sortedModules.map(([m]) => m) }
            ];

            // Calculate which trusts are covered by MVP
            const mvpCoveredTrusts = TRUST_TYPES.filter(trust => {
                const trustModules = [];
                Object.values(trust.modules).forEach(moduleArray => {
                    moduleArray.forEach(mod => trustModules.push(mod));
                });
                // Trust is covered if ALL its modules are in MVP
                return trustModules.length > 0 && trustModules.every(mod => mvpModules.includes(mod));
            });

            // Calculate partial coverage (trusts that use at least some MVP modules)
            const mvpPartialTrusts = TRUST_TYPES.filter(trust => {
                const trustModules = [];
                Object.values(trust.modules).forEach(moduleArray => {
                    moduleArray.forEach(mod => trustModules.push(mod));
                });
                return trustModules.some(mod => mvpModules.includes(mod)) && 
                       !trustModules.every(mod => mvpModules.includes(mod));
            });

            // Calculate modules needed for 70%, 80%, and 90% coverage
            function calculateCoverageAtModuleCount(moduleCount) {
                const modules = sortedModules.slice(0, moduleCount).map(([m]) => m);
                const coveredTrusts = TRUST_TYPES.filter(trust => {
                    const trustModules = [];
                    Object.values(trust.modules).forEach(moduleArray => {
                        moduleArray.forEach(mod => trustModules.push(mod));
                    });
                    return trustModules.length > 0 && trustModules.every(mod => modules.includes(mod));
                });
                return {
                    moduleCount,
                    modules,
                    coveredTrusts,
                    coveragePercent: (coveredTrusts.length / totalTrusts) * 100
                };
            }

            // Find minimum modules needed for each threshold (10% to 100% by tens)
            const thresholdTargets = [10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
            const thresholdResults = {};
            
            for (let target of thresholdTargets) {
                thresholdResults[target] = null;
            }

            for (let i = 1; i <= sortedModules.length; i++) {
                const result = calculateCoverageAtModuleCount(i);
                // Check each threshold that hasn't been found yet
                for (let target of thresholdTargets) {
                    if (!thresholdResults[target] && result.coveragePercent >= target) {
                        thresholdResults[target] = result;
                    }
                }
                // Stop if all thresholds found
                if (Object.values(thresholdResults).every(r => r !== null)) break;
            }

            container.innerHTML = `
                <div class="bg-gradient-to-r from-blue-600/20 to-cyan-600/20 p-6 rounded-xl border border-blue-500/30 mb-6">
                    <h4 class="text-lg font-bold text-white mb-4">üéØ MVP Definition: Top 8 Most-Used Modules</h4>
                    <div class="grid md:grid-cols-4 lg:grid-cols-8 gap-3 mb-4">
                        ${mvpModules.map((module, idx) => {
                            const count = moduleCounts[module];
                            const percentage = ((count / totalTrusts) * 100).toFixed(0);
                            return `
                                <div class="bg-slate-800/50 p-3 rounded-lg border border-cyan-500/30">
                                    <div class="text-xs text-slate-400 mb-1">#${idx + 1}</div>
                                    <div class="font-bold text-cyan-400 text-sm mb-1">${module}</div>
                                    <div class="text-xs text-slate-300">${count}/${totalTrusts} trusts (${percentage}%)</div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                    <div class="grid md:grid-cols-3 gap-4 mt-4">
                        <div class="bg-slate-800/50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-emerald-400 mb-1">${mvpCoveredTrusts.length}</div>
                            <div class="text-xs text-slate-300">Fully Covered Trusts</div>
                            <div class="text-xs text-slate-400 mt-1">All modules in MVP</div>
                        </div>
                        <div class="bg-slate-800/50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-cyan-400 mb-1">${mvpPartialTrusts.length}</div>
                            <div class="text-xs text-slate-300">Partially Covered</div>
                            <div class="text-xs text-slate-400 mt-1">Some MVP modules</div>
                        </div>
                        <div class="bg-slate-800/50 p-4 rounded-lg">
                            <div class="text-2xl font-bold text-blue-400 mb-1">${((mvpCoveredTrusts.length / totalTrusts) * 100).toFixed(0)}%</div>
                            <div class="text-xs text-slate-300">Full Coverage Rate</div>
                            <div class="text-xs text-slate-400 mt-1">With MVP only</div>
                        </div>
                    </div>
                </div>

                <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                    <h4 class="text-lg font-bold text-white mb-4">üìä Coverage Analysis by Module Count</h4>
                    <div class="space-y-4">
                        ${coverageLevels.map(level => {
                            const coveredTrusts = TRUST_TYPES.filter(trust => {
                                const trustModules = [];
                                Object.values(trust.modules).forEach(moduleArray => {
                                    moduleArray.forEach(mod => trustModules.push(mod));
                                });
                                return trustModules.length > 0 && trustModules.every(mod => level.modules.includes(mod));
                            });
                            const coveragePercent = ((coveredTrusts.length / totalTrusts) * 100).toFixed(1);
                            
                            return `
                                <div class="bg-slate-900/50 p-4 rounded-lg border-l-4 ${level.count === 8 ? 'border-cyan-500' : level.count === 10 ? 'border-blue-500' : level.count === 15 ? 'border-purple-500' : 'border-emerald-500'}">
                                    <div class="flex justify-between items-center mb-2">
                                        <h5 class="font-bold text-white">${level.name}</h5>
                                        <span class="text-sm font-semibold ${level.count === 8 ? 'text-cyan-400' : level.count === 10 ? 'text-blue-400' : level.count === 15 ? 'text-purple-400' : 'text-emerald-400'}">
                                            ${coveragePercent}% Coverage
                                        </span>
                                    </div>
                                    <div class="text-sm text-slate-300 mb-2">
                                        <strong>${coveredTrusts.length}</strong> of <strong>${totalTrusts}</strong> trust types fully supported
                                    </div>
                                    ${level.count === 8 ? `
                                        <div class="mt-3 pt-3 border-t border-slate-700">
                                            <p class="text-xs font-semibold text-cyan-400 mb-2">Trust Types Covered by MVP:</p>
                                            <div class="flex flex-wrap gap-2">
                                                ${mvpCoveredTrusts.slice(0, 10).map(trust => 
                                                    `<span class="px-2 py-1 bg-cyan-500/20 text-cyan-300 rounded text-xs border border-cyan-500/30">${trust.name}</span>`
                                                ).join('')}
                                                ${mvpCoveredTrusts.length > 10 ? `<span class="px-2 py-1 bg-slate-700 text-slate-400 rounded text-xs">+${mvpCoveredTrusts.length - 10} more</span>` : ''}
                                            </div>
                                        </div>
                                    ` : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <div class="bg-gradient-to-r from-emerald-600/20 to-teal-600/20 p-6 rounded-xl border border-emerald-500/30 mb-6">
                    <h4 class="text-lg font-bold text-white mb-4">üéØ Coverage Threshold Analysis</h4>
                    <p class="text-sm text-slate-300 mb-4">Minimum modules needed to achieve target coverage percentages (10% to 100% by tens):</p>
                    <div class="space-y-6">
                        ${thresholdTargets.map(target => {
                            const result = thresholdResults[target];
                            if (!result) return `
                                <div class="bg-slate-800/50 p-4 rounded-lg border-l-4 border-slate-600">
                                    <h5 class="font-bold text-white text-lg mb-2">${target}% Coverage Target</h5>
                                    <p class="text-slate-400 text-sm">Not achievable with available modules</p>
                                </div>
                            `;
                            
                            // Color scheme based on threshold - using Tailwind-safe class names
                            const colorClasses = {
                                10: { border: 'border-emerald-500', text: 'text-emerald-400', textLight: 'text-emerald-300', bg: 'bg-emerald-500/20' },
                                20: { border: 'border-green-500', text: 'text-green-400', textLight: 'text-green-300', bg: 'bg-green-500/20' },
                                30: { border: 'border-teal-500', text: 'text-teal-400', textLight: 'text-teal-300', bg: 'bg-teal-500/20' },
                                40: { border: 'border-cyan-500', text: 'text-cyan-400', textLight: 'text-cyan-300', bg: 'bg-cyan-500/20' },
                                50: { border: 'border-sky-500', text: 'text-sky-400', textLight: 'text-sky-300', bg: 'bg-sky-500/20' },
                                60: { border: 'border-blue-500', text: 'text-blue-400', textLight: 'text-blue-300', bg: 'bg-blue-500/20' },
                                70: { border: 'border-indigo-500', text: 'text-indigo-400', textLight: 'text-indigo-300', bg: 'bg-indigo-500/20' },
                                80: { border: 'border-violet-500', text: 'text-violet-400', textLight: 'text-violet-300', bg: 'bg-violet-500/20' },
                                90: { border: 'border-purple-500', text: 'text-purple-400', textLight: 'text-purple-300', bg: 'bg-purple-500/20' },
                                100: { border: 'border-pink-500', text: 'text-pink-400', textLight: 'text-pink-300', bg: 'bg-pink-500/20' }
                            };
                            const colors = colorClasses[target] || { border: 'border-slate-500', text: 'text-slate-400', textLight: 'text-slate-300', bg: 'bg-slate-500/20' };
                            
                            return `
                                <div class="bg-slate-800/50 p-6 rounded-lg border-l-4 ${colors.border}">
                                    <div class="flex items-center justify-between mb-4">
                                        <div>
                                            <h5 class="font-bold text-white text-lg mb-1">${target}% Coverage Target</h5>
                                            <p class="text-sm text-slate-400">Requires <strong class="${colors.text} text-xl">${result.moduleCount}</strong> modules</p>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-3xl font-bold ${colors.text}">${result.coveragePercent.toFixed(1)}%</div>
                                            <div class="text-xs text-slate-400">Actual Coverage</div>
                                        </div>
                                    </div>
                                    
                                    <div class="grid md:grid-cols-2 gap-6">
                                        <div>
                                            <p class="text-sm font-semibold ${colors.textLight} mb-3">All Modules Required (${result.moduleCount}):</p>
                                            <div class="bg-slate-900/50 p-3 rounded-lg max-h-60 overflow-y-auto">
                                                <div class="flex flex-wrap gap-2">
                                                    ${result.modules.map((m, idx) => 
                                                        `<span class="px-2 py-1 ${colors.bg} ${colors.text} rounded text-xs border ${colors.border}">
                                                            #${idx + 1} ${m}
                                                        </span>`
                                                    ).join('')}
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <p class="text-sm font-semibold ${colors.textLight} mb-3">Trust Types Covered (${result.coveredTrusts.length} of ${totalTrusts}):</p>
                                            <div class="bg-slate-900/50 p-3 rounded-lg max-h-60 overflow-y-auto">
                                                <div class="space-y-1">
                                                    ${result.coveredTrusts.map(trust => 
                                                        `<div class="text-xs text-slate-300 px-2 py-1 bg-slate-800/50 rounded">‚Ä¢ ${trust.name}</div>`
                                                    ).join('')}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>

                <div class="bg-gradient-to-r from-purple-600/20 to-pink-600/20 p-6 rounded-xl border border-purple-500/30">
                    <h4 class="text-lg font-bold text-white mb-4">üí° Strategic Insight</h4>
                    <div class="grid md:grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="text-slate-300 mb-2"><strong class="text-purple-400">MVP Approach (Top 8):</strong></p>
                            <p class="text-slate-400 text-xs">
                                Building just the top 8 most-used modules provides <strong class="text-white">${((mvpCoveredTrusts.length / totalTrusts) * 100).toFixed(0)}% full coverage</strong> 
                                of trust types, enabling rapid market entry with minimal development effort.
                            </p>
                        </div>
                        <div>
                            <p class="text-slate-300 mb-2"><strong class="text-pink-400">Coverage Milestones (10% increments):</strong></p>
                            <p class="text-slate-400 text-xs">
                                ${thresholdTargets.map(target => {
                                    const result = thresholdResults[target];
                                    return result ? `${target}%: ${result.moduleCount} modules` : null;
                                }).filter(Boolean).join(' ‚Ä¢ ')}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            populateTrustDropdown();
            populateModuleFilter();
            renderTrustTypes();
            renderModuleStats();
            renderMVPAnalysis();

            document.getElementById('trustSearch').addEventListener('input', applyFilters);
        });

        // Pitch Deck Generator for Orion Innovation
        function generatePitchDeck() {
            const container = document.getElementById('pitchDeckContainer');
            container.innerHTML = '';

            const pitchSlides = [
                {
                    title: 'The Opportunity: Trust Automation for Digital Transformation',
                    content: `
                        <div class="space-y-4">
                            <p class="text-lg text-slate-300 leading-relaxed">
                                Orion Innovation serves <strong class="text-blue-400">6,000+ associates</strong> across <strong class="text-blue-400">12 delivery centers</strong> worldwide, 
                                with deep expertise in <strong class="text-cyan-400">Wealth & Asset Management</strong> and <strong class="text-cyan-400">Financial Services</strong>.
                            </p>
                            <div class="bg-gradient-to-r from-blue-600/20 to-cyan-600/20 p-5 rounded-xl border border-blue-500/30">
                                <h4 class="text-lg font-bold text-white mb-3">üåç Orion's Global Delivery Centers: Strategic Advantage</h4>
                                <p class="text-slate-300 text-sm mb-3">
                                    Orion's <strong class="text-cyan-400">12 delivery centers</strong> are distributed globally to provide:
                                </p>
                                <div class="grid md:grid-cols-2 gap-3 text-sm">
                                    <div>
                                        <p class="text-slate-300 mb-2"><strong class="text-blue-400">24/7 Operations:</strong></p>
                                        <p class="text-slate-400 text-xs">Round-the-clock trust administration and monitoring across time zones, ensuring continuous service for global clients.</p>
                                    </div>
                                    <div>
                                        <p class="text-slate-300 mb-2"><strong class="text-cyan-400">Regulatory Expertise:</strong></p>
                                        <p class="text-slate-400 text-xs">Local knowledge of trust laws, tax regulations, and compliance requirements in multiple jurisdictions.</p>
                                    </div>
                                    <div>
                                        <p class="text-slate-300 mb-2"><strong class="text-purple-400">Scalability:</strong></p>
                                        <p class="text-slate-400 text-xs">Distributed workforce enables rapid scaling of trust operations without geographic constraints.</p>
                                    </div>
                                    <div>
                                        <p class="text-slate-300 mb-2"><strong class="text-emerald-400">Risk Diversification:</strong></p>
                                        <p class="text-slate-400 text-xs">Redundant operations across centers ensure business continuity and disaster recovery capabilities.</p>
                                    </div>
                                </div>
                                <p class="text-slate-300 text-sm mt-4">
                                    <strong class="text-white">Why This Matters for Trust Automation:</strong> Our platform can leverage Orion's existing delivery center infrastructure 
                                    to provide <strong class="text-cyan-400">localized trust services</strong> with <strong class="text-cyan-400">global consistency</strong>, enabling 
                                    enterprise clients to manage trusts across multiple jurisdictions through a single automated system.
                                </p>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-lg border-l-4 border-blue-500">
                                <p class="text-slate-300">
                                    <strong class="text-white">The Challenge:</strong> Trust creation and management remains manual, time-intensive, and error-prone, 
                                    limiting scalability for Orion's enterprise clients managing billions in assets.
                                </p>
                            </div>
                            <div class="bg-slate-800/50 p-4 rounded-lg border-l-4 border-cyan-500">
                                <p class="text-slate-300">
                                    <strong class="text-white">The Solution:</strong> Automated trust creation and execution platform that integrates with 
                                    Orion's existing <strong class="text-cyan-400">Cloud & Infrastructure</strong> and <strong class="text-cyan-400">Data & Analytics</strong> capabilities.
                                </p>
                            </div>
                        </div>
                    `
                },
                {
                    title: 'Why Orion Innovation Needs Trust Automation',
                    content: `
                        <div class="grid md:grid-cols-2 gap-4">
                            <div class="bg-slate-800/50 p-5 rounded-lg border border-slate-700">
                                <h4 class="text-lg font-bold text-blue-400 mb-3">üí∞ Market Opportunity</h4>
                                <ul class="space-y-2 text-slate-300 text-sm">
                                    <li>‚Ä¢ <strong>$5T+</strong> in US trust assets</li>
                                    <li>‚Ä¢ Only <strong>2%</strong> of US adults have trusts</li>
                                    <li>‚Ä¢ Growing demand for <strong>digital wealth management</strong></li>
                                    <li>‚Ä¢ Orion's FinTech clients need scalable solutions</li>
                                </ul>
                            </div>
                            <div class="bg-slate-800/50 p-5 rounded-lg border border-slate-700">
                                <h4 class="text-lg font-bold text-cyan-400 mb-3">üöÄ Competitive Advantage</h4>
                                <ul class="space-y-2 text-slate-300 text-sm">
                                    <li>‚Ä¢ Differentiate in <strong>Wealth & Asset Management</strong></li>
                                    <li>‚Ä¢ Leverage Orion's <strong>30+ years</strong> of expertise</li>
                                    <li>‚Ä¢ Integrate with existing <strong>Cloud & Data</strong> platforms</li>
                                    <li>‚Ä¢ Enable <strong>Generative AI</strong> for trust recommendations</li>
                                </ul>
                            </div>
                            <div class="bg-slate-800/50 p-5 rounded-lg border border-slate-700">
                                <h4 class="text-lg font-bold text-purple-400 mb-3">‚ö° Operational Efficiency</h4>
                                <ul class="space-y-2 text-slate-300 text-sm">
                                    <li>‚Ä¢ Reduce trust setup time from <strong>weeks to hours</strong></li>
                                    <li>‚Ä¢ Eliminate manual errors in trust documentation</li>
                                    <li>‚Ä¢ Scale trust services across <strong>12 delivery centers</strong> with 24/7 global operations</li>
                                    <li>‚Ä¢ Enable real-time compliance monitoring</li>
                                </ul>
                            </div>
                            <div class="bg-slate-800/50 p-5 rounded-lg border border-slate-700">
                                <h4 class="text-lg font-bold text-emerald-400 mb-3">üîí Risk Mitigation</h4>
                                <ul class="space-y-2 text-slate-300 text-sm">
                                    <li>‚Ä¢ Automated compliance with <strong>IRS regulations</strong></li>
                                    <li>‚Ä¢ Built-in <strong>Cybersecurity</strong> best practices</li>
                                    <li>‚Ä¢ Audit trails for regulatory requirements</li>
                                    <li>‚Ä¢ Integration with Orion's <strong>Security Operations</strong></li>
                                </ul>
                            </div>
                        </div>
                    `
                },
                {
                    title: 'Addressing Real Advisor Feedback & Pain Points',
                    content: `
                        <div class="space-y-6">
                            <p class="text-lg text-slate-300 leading-relaxed mb-4">
                                Based on industry feedback from wealth management advisors and trust administrators, here are the most common pain points with existing trust software and manual processes, and how our automation suite addresses them:
                            </p>
                            
                            <div class="space-y-4">
                                <div class="bg-slate-800/50 p-5 rounded-lg border-l-4 border-red-500">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0">
                                            <div class="w-12 h-12 rounded-full bg-red-500/20 flex items-center justify-center">
                                                <span class="text-2xl">üò§</span>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="text-lg font-bold text-white mb-2">Advisor Complaint: "Trust setup takes weeks of manual paperwork"</h4>
                                            <p class="text-sm text-slate-400 mb-3 italic">
                                                "We spend 2-3 weeks just gathering documents, filling out forms, and coordinating with attorneys. Clients get frustrated with the delays."
                                            </p>
                                            <div class="bg-slate-900/50 p-3 rounded border border-cyan-500/30">
                                                <p class="text-sm text-cyan-300 font-semibold mb-1">Our Solution:</p>
                                                <p class="text-sm text-slate-300">
                                                    Automated trust creation reduces setup from <strong class="text-white">weeks to hours</strong>. Our rules framework auto-generates all required documentation (trust agreements, Crummey notices, regulatory filings) based on client inputs. Integration with Orion's <strong class="text-cyan-400">Data & Analytics</strong> platforms pre-populates client information, eliminating redundant data entry.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-800/50 p-5 rounded-lg border-l-4 border-orange-500">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0">
                                            <div class="w-12 h-12 rounded-full bg-orange-500/20 flex items-center justify-center">
                                                <span class="text-2xl">üò∞</span>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="text-lg font-bold text-white mb-2">Advisor Complaint: "Too many errors in manual trust administration"</h4>
                                            <p class="text-sm text-slate-400 mb-3 italic">
                                                "We've had compliance issues because manual processes miss required notices, miscalculate distributions, or fail to track deadlines. One mistake can cost thousands in penalties."
                                            </p>
                                            <div class="bg-slate-900/50 p-3 rounded border border-cyan-500/30">
                                                <p class="text-sm text-cyan-300 font-semibold mb-1">Our Solution:</p>
                                                <p class="text-sm text-slate-300">
                                                    Built-in compliance engine validates all trust actions against IRS regulations and state requirements in real-time. Automated deadline tracking and reminders prevent missed distributions, premium payments, or tax filings. Our <strong class="text-cyan-400">Rules Framework Testing</strong> phase ensures 100% accuracy before money movement, eliminating costly errors.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-800/50 p-5 rounded-lg border-l-4 border-yellow-500">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0">
                                            <div class="w-12 h-12 rounded-full bg-yellow-500/20 flex items-center justify-center">
                                                <span class="text-2xl">üòì</span>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="text-lg font-bold text-white mb-2">Advisor Complaint: "Can't scale trust services - each one requires too much manual oversight"</h4>
                                            <p class="text-sm text-slate-400 mb-3 italic">
                                                "We're turning away clients because we don't have the staff to manage more trusts. Each trust needs constant attention for distributions, tax reporting, and compliance monitoring."
                                            </p>
                                            <div class="bg-slate-900/50 p-3 rounded border border-cyan-500/30">
                                                <p class="text-sm text-cyan-300 font-semibold mb-1">Our Solution:</p>
                                                <p class="text-sm text-slate-300">
                                                    Automated lifecycle management handles routine trust administration tasks (distributions, premium payments, compliance checks) without manual intervention. Leverages Orion's <strong class="text-cyan-400">12 delivery centers</strong> for 24/7 monitoring and support. One advisor can now manage <strong class="text-white">10x more trusts</strong> with the same effort, enabling rapid scaling.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-800/50 p-5 rounded-lg border-l-4 border-purple-500">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0">
                                            <div class="w-12 h-12 rounded-full bg-purple-500/20 flex items-center justify-center">
                                                <span class="text-2xl">üòï</span>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="text-lg font-bold text-white mb-2">Advisor Complaint: "Existing software doesn't handle alternative assets like real estate"</h4>
                                            <p class="text-sm text-slate-400 mb-3 italic">
                                                "Our clients want to put commercial real estate and private equity in trusts, but current systems only handle stocks and bonds. We're doing manual workarounds that are error-prone."
                                            </p>
                                            <div class="bg-slate-900/50 p-3 rounded border border-cyan-500/30">
                                                <p class="text-sm text-cyan-300 font-semibold mb-1">Our Solution:</p>
                                                <p class="text-sm text-slate-300">
                                                    Our rules framework natively supports alternative assets (real estate, private equity, art, crypto) with automated valuation tracking, rental income management, and distribution calculations. Integration with Orion's <strong class="text-cyan-400">Data & Analytics</strong> platforms provides real-time asset valuations and performance tracking for all asset types.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-800/50 p-5 rounded-lg border-l-4 border-pink-500">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0">
                                            <div class="w-12 h-12 rounded-full bg-pink-500/20 flex items-center justify-center">
                                                <span class="text-2xl">üòü</span>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="text-lg font-bold text-white mb-2">Advisor Complaint: "No visibility into trust performance and compliance status"</h4>
                                            <p class="text-sm text-slate-400 mb-3 italic">
                                                "We can't easily see which trusts need attention, which are compliant, or how they're performing. We're flying blind until something goes wrong."
                                            </p>
                                            <div class="bg-slate-900/50 p-3 rounded border border-cyan-500/30">
                                                <p class="text-sm text-cyan-300 font-semibold mb-1">Our Solution:</p>
                                                <p class="text-sm text-slate-300">
                                                    Real-time dashboards powered by Orion's <strong class="text-cyan-400">Data & Analytics</strong> show trust performance, compliance status, upcoming deadlines, and tax benefits across all trusts. Automated alerts notify advisors of issues before they become problems. Full audit trails for regulatory requirements.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="bg-slate-800/50 p-5 rounded-lg border-l-4 border-indigo-500">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-shrink-0">
                                            <div class="w-12 h-12 rounded-full bg-indigo-500/20 flex items-center justify-center">
                                                <span class="text-2xl">üò§</span>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="text-lg font-bold text-white mb-2">Advisor Complaint: "Integration with existing systems is a nightmare"</h4>
                                            <p class="text-sm text-slate-400 mb-3 italic">
                                                "We have client data in CRM, portfolio data in another system, and trust info in spreadsheets. Nothing talks to each other, so we're constantly re-entering data and risking errors."
                                            </p>
                                            <div class="bg-slate-900/50 p-3 rounded border border-cyan-500/30">
                                                <p class="text-sm text-cyan-300 font-semibold mb-1">Our Solution:</p>
                                                <p class="text-sm text-slate-300">
                                                    Built on Orion's <strong class="text-cyan-400">Cloud & Infrastructure</strong> and <strong class="text-cyan-400">Enterprise Platforms</strong>, our platform integrates seamlessly with existing systems via APIs. The <strong class="text-white">Data Layer Migration</strong> phase (Phase 1) normalizes data from multiple sources into a unified rules framework, eliminating silos and redundant data entry.
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="bg-gradient-to-r from-emerald-600/20 to-cyan-600/20 p-6 rounded-xl border border-emerald-500/30 mt-6">
                                <h4 class="text-lg font-bold text-white mb-3">üí° Key Takeaway</h4>
                                <p class="text-slate-300 text-sm">
                                    Our automation suite directly addresses the most critical pain points advisors face daily. By automating manual processes, ensuring compliance, and providing real-time visibility, we transform trust administration from a time-consuming burden into a scalable, efficient service that enables advisors to serve more clients with less effort.
                                </p>
                            </div>
                        </div>
                    `
                },
                {
                    title: 'Our Automated Trust Solution: Three-Phase Architecture',
                    content: `
                        <div class="space-y-6">
                            <div class="bg-gradient-to-r from-blue-600/20 to-cyan-600/20 p-6 rounded-xl border border-blue-500/30">
                                <h4 class="text-xl font-bold text-white mb-4">Platform Architecture</h4>
                                <div class="grid md:grid-cols-3 gap-4">
                                    <div class="bg-slate-800/50 p-4 rounded-lg border border-blue-500/30">
                                        <h5 class="font-semibold text-blue-400 mb-2">üìä Phase 1: Data Layer</h5>
                                        <p class="text-sm text-slate-300 mb-2">
                                            Unified rules framework that ingests and normalizes existing trust data from multiple sources.
                                        </p>
                                        <ul class="text-xs text-slate-400 space-y-1 mt-2">
                                            <li>‚Ä¢ Legacy trust migration</li>
                                            <li>‚Ä¢ Data normalization</li>
                                            <li>‚Ä¢ Rules framework mapping</li>
                                        </ul>
                                    </div>
                                    <div class="bg-slate-800/50 p-4 rounded-lg border border-cyan-500/30">
                                        <h5 class="font-semibold text-cyan-400 mb-2">‚öôÔ∏è Phase 2: Rules Engine</h5>
                                        <p class="text-sm text-slate-300 mb-2">
                                            Intelligent rules framework that interprets trust terms, validates compliance, and executes logic.
                                        </p>
                                        <ul class="text-xs text-slate-400 space-y-1 mt-2">
                                            <li>‚Ä¢ Trust type interpretation</li>
                                            <li>‚Ä¢ Compliance validation</li>
                                            <li>‚Ä¢ Automated testing</li>
                                        </ul>
                                    </div>
                                    <div class="bg-slate-800/50 p-4 rounded-lg border border-purple-500/30">
                                        <h5 class="font-semibold text-purple-400 mb-2">üí∞ Phase 3: Money Movement</h5>
                                        <p class="text-sm text-slate-300 mb-2">
                                            Secure integration layer connecting rules engine to payment systems and banking infrastructure.
                                        </p>
                                        <ul class="text-xs text-slate-400 space-y-1 mt-2">
                                            <li>‚Ä¢ Payment processing</li>
                                            <li>‚Ä¢ Distribution automation</li>
                                            <li>‚Ä¢ Transaction monitoring</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-slate-800/50 p-5 rounded-lg">
                                <h5 class="font-semibold text-white mb-3">üîó Integration with Orion's Tech Stack</h5>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <h6 class="text-sm font-semibold text-cyan-400 mb-2">Phase 1 & 2 Integration</h6>
                                        <div class="flex flex-wrap gap-2">
                                            <span class="px-3 py-1 bg-blue-500/20 text-blue-300 rounded-full text-xs border border-blue-500/30">Cloud & Infrastructure</span>
                                            <span class="px-3 py-1 bg-cyan-500/20 text-cyan-300 rounded-full text-xs border border-cyan-500/30">Data & Analytics</span>
                                            <span class="px-3 py-1 bg-purple-500/20 text-purple-300 rounded-full text-xs border border-purple-500/30">Generative AI</span>
                                            <span class="px-3 py-1 bg-emerald-500/20 text-emerald-300 rounded-full text-xs border border-emerald-500/30">Cybersecurity</span>
                                        </div>
                                    </div>
                                    <div>
                                        <h6 class="text-sm font-semibold text-purple-400 mb-2">Phase 3 Integration</h6>
                                        <div class="flex flex-wrap gap-2">
                                            <span class="px-3 py-1 bg-pink-500/20 text-pink-300 rounded-full text-xs border border-pink-500/30">Enterprise Platforms</span>
                                            <span class="px-3 py-1 bg-blue-500/20 text-blue-300 rounded-full text-xs border border-blue-500/30">Payment APIs</span>
                                            <span class="px-3 py-1 bg-cyan-500/20 text-cyan-300 rounded-full text-xs border border-cyan-500/30">Real-time Monitoring</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-slate-800/50 to-slate-700/50 p-4 rounded-lg">
                                <h5 class="font-semibold text-white mb-2">üéØ Key Capabilities</h5>
                                <div class="grid md:grid-cols-2 gap-3 text-sm text-slate-300">
                                    <div class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span><strong>25+ trust types</strong> supported with modular rules framework</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span><strong>Automated compliance</strong> validation (IRS, state regulations)</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span><strong>Real-time monitoring</strong> and audit trails for all transactions</span>
                                    </div>
                                    <div class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span><strong>Scalable architecture</strong> across 12 delivery centers</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                },
                {
                    title: 'Business Value for Orion Innovation',
                    content: `
                        <div class="space-y-4">
                            <div class="grid md:grid-cols-3 gap-4">
                                <div class="bg-slate-800/50 p-5 rounded-lg border-t-4 border-blue-500">
                                    <div class="text-3xl font-bold text-blue-400 mb-2">10x</div>
                                    <p class="text-sm text-slate-300">Faster trust creation</p>
                                    <p class="text-xs text-slate-400 mt-2">From weeks to hours, enabling rapid client onboarding</p>
                                </div>
                                <div class="bg-slate-800/50 p-5 rounded-lg border-t-4 border-cyan-500">
                                    <div class="text-3xl font-bold text-cyan-400 mb-2">90%</div>
                                    <p class="text-sm text-slate-300">Reduction in errors</p>
                                    <p class="text-xs text-slate-400 mt-2">Automated compliance checks eliminate manual mistakes</p>
                                </div>
                                <div class="bg-slate-800/50 p-5 rounded-lg border-t-4 border-purple-500">
                                    <div class="text-3xl font-bold text-purple-400 mb-2">$2M+</div>
                                    <p class="text-sm text-slate-300">Annual cost savings</p>
                                    <p class="text-xs text-slate-400 mt-2">Per enterprise client through operational efficiency</p>
                                </div>
                            </div>
                            <div class="bg-gradient-to-r from-slate-800/50 to-slate-700/50 p-6 rounded-xl">
                                <h4 class="text-lg font-bold text-white mb-4">Revenue Opportunities</h4>
                                <div class="grid md:grid-cols-2 gap-4">
                                    <div>
                                        <h5 class="font-semibold text-cyan-400 mb-2">New Service Line</h5>
                                        <p class="text-sm text-slate-300">
                                            Offer trust automation as a premium service to Wealth & Asset Management clients, 
                                            creating a new recurring revenue stream.
                                        </p>
                                    </div>
                                    <div>
                                        <h5 class="font-semibold text-cyan-400 mb-2">Platform Licensing</h5>
                                        <p class="text-sm text-slate-300">
                                            License the platform to other financial institutions, leveraging Orion's 
                                            <strong class="text-white">Platforms & IP</strong> expertise.
                                        </p>
                                    </div>
                                    <div>
                                        <h5 class="font-semibold text-cyan-400 mb-2">Upsell Existing Clients</h5>
                                        <p class="text-sm text-slate-300">
                                            Enhance existing <strong class="text-white">Cloud & Infrastructure</strong> and 
                                            <strong class="text-white">Data & Analytics</strong> engagements with trust automation.
                                        </p>
                                    </div>
                                    <div>
                                        <h5 class="font-semibold text-cyan-400 mb-2">Market Expansion</h5>
                                        <p class="text-sm text-slate-300">
                                            Enter the underserved middle-market segment (only 2% adoption), 
                                            opening a massive new market opportunity.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                },
                {
                    title: 'Three-Phase Implementation Roadmap',
                    content: `
                        <div class="space-y-4">
                            <div class="bg-slate-800/30 p-4 rounded-lg border border-slate-700 mb-6">
                                <p class="text-slate-300 text-sm">
                                    Our phased approach minimizes risk while delivering incremental value. Each phase builds on the previous, 
                                    ensuring a solid foundation before moving to production money movement.
                                </p>
                            </div>
                            <div class="relative">
                                <div class="absolute left-4 top-0 bottom-0 w-0.5 bg-gradient-to-b from-blue-500 via-cyan-500 to-purple-500"></div>
                                <div class="space-y-6 pl-12">
                                    <div class="relative">
                                        <div class="absolute -left-8 w-4 h-4 bg-blue-500 rounded-full border-2 border-slate-900"></div>
                                        <div class="bg-slate-800/50 p-5 rounded-lg border-l-4 border-blue-500">
                                            <h5 class="font-bold text-white mb-3 text-lg">Phase 1: Data Layer Migration</h5>
                                            <p class="text-sm text-slate-400 mb-3">Migrate existing trusts into our rules framework</p>
                                            <ul class="text-sm text-slate-300 space-y-2">
                                                <li class="flex items-start">
                                                    <span class="text-blue-400 mr-2">‚Ä¢</span>
                                                    <span>Extract and normalize trust data from Orion's existing <strong class="text-cyan-400">Data & Analytics</strong> systems</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-blue-400 mr-2">‚Ä¢</span>
                                                    <span>Map legacy trust structures to our modular rules framework (25+ trust types)</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-blue-400 mr-2">‚Ä¢</span>
                                                    <span>Build data migration pipelines leveraging Orion's <strong class="text-blue-400">Cloud & Infrastructure</strong> capabilities</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-blue-400 mr-2">‚Ä¢</span>
                                                    <span>Create unified data model for all trust types across client portfolios</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-blue-400 mr-2">‚Ä¢</span>
                                                    <span>Implement data validation and quality checks with Orion's <strong class="text-emerald-400">Cybersecurity</strong> standards</span>
                                                </li>
                                            </ul>
                                            <div class="mt-4 pt-3 border-t border-slate-700">
                                                <p class="text-xs text-slate-400"><strong class="text-white">Deliverable:</strong> All existing trusts migrated and accessible through rules framework</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <div class="absolute -left-8 w-4 h-4 bg-cyan-500 rounded-full border-2 border-slate-900"></div>
                                        <div class="bg-slate-800/50 p-5 rounded-lg border-l-4 border-cyan-500">
                                            <h5 class="font-bold text-white mb-3 text-lg">Phase 2: Rules Framework Testing</h5>
                                            <p class="text-sm text-slate-400 mb-3">Validate rules engine accuracy and compliance</p>
                                            <ul class="text-sm text-slate-300 space-y-2">
                                                <li class="flex items-start">
                                                    <span class="text-cyan-400 mr-2">‚Ä¢</span>
                                                    <span>Test rules engine against migrated trust data to ensure accurate interpretation</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-cyan-400 mr-2">‚Ä¢</span>
                                                    <span>Validate compliance rules (IRS regulations, state requirements, tax calculations)</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-cyan-400 mr-2">‚Ä¢</span>
                                                    <span>Run parallel processing: rules engine vs. manual trust administration</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-cyan-400 mr-2">‚Ä¢</span>
                                                    <span>Integrate with Orion's <strong class="text-purple-400">Generative AI</strong> for trust recommendations and validation</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-cyan-400 mr-2">‚Ä¢</span>
                                                    <span>Build comprehensive test suite covering all trust types and edge cases</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-cyan-400 mr-2">‚Ä¢</span>
                                                    <span>Pilot with select Wealth & Asset Management clients in sandbox environment</span>
                                                </li>
                                            </ul>
                                            <div class="mt-4 pt-3 border-t border-slate-700">
                                                <p class="text-xs text-slate-400"><strong class="text-white">Deliverable:</strong> Validated, tested rules engine ready for production money movement</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="relative">
                                        <div class="absolute -left-8 w-4 h-4 bg-purple-500 rounded-full border-2 border-slate-900"></div>
                                        <div class="bg-slate-800/50 p-5 rounded-lg border-l-4 border-purple-500">
                                            <h5 class="font-bold text-white mb-3 text-lg">Phase 3: Money Movement Integration</h5>
                                            <p class="text-sm text-slate-400 mb-3">Connect rules engine to actual financial transactions</p>
                                            <ul class="text-sm text-slate-300 space-y-2">
                                                <li class="flex items-start">
                                                    <span class="text-purple-400 mr-2">‚Ä¢</span>
                                                    <span>Integrate rules engine with payment systems and banking APIs</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-purple-400 mr-2">‚Ä¢</span>
                                                    <span>Connect to Orion's existing <strong class="text-blue-400">Cloud & Infrastructure</strong> for secure transaction processing</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-purple-400 mr-2">‚Ä¢</span>
                                                    <span>Implement automated distributions, premium payments, and asset transfers</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-purple-400 mr-2">‚Ä¢</span>
                                                    <span>Build real-time monitoring and alerting using Orion's <strong class="text-cyan-400">Data & Analytics</strong> platforms</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-purple-400 mr-2">‚Ä¢</span>
                                                    <span>Deploy across all <strong class="text-cyan-400">12 delivery centers</strong> with full audit trails</span>
                                                </li>
                                                <li class="flex items-start">
                                                    <span class="text-purple-400 mr-2">‚Ä¢</span>
                                                    <span>Launch as production service for Wealth & Asset Management clients</span>
                                                </li>
                                            </ul>
                                            <div class="mt-4 pt-3 border-t border-slate-700">
                                                <p class="text-xs text-slate-400"><strong class="text-white">Deliverable:</strong> Fully automated trust execution with end-to-end money movement</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-6 bg-gradient-to-r from-blue-600/20 to-purple-600/20 p-6 rounded-xl border border-blue-500/30">
                                <h4 class="text-lg font-bold text-white mb-4">Risk Mitigation Strategy</h4>
                                <div class="grid md:grid-cols-3 gap-4">
                                    <div>
                                        <h5 class="font-semibold text-cyan-400 mb-2">Phase 1 Safety</h5>
                                        <p class="text-xs text-slate-300">Read-only data migration, no impact on existing operations</p>
                                    </div>
                                    <div>
                                        <h5 class="font-semibold text-cyan-400 mb-2">Phase 2 Safety</h5>
                                        <p class="text-xs text-slate-300">Sandbox testing environment, parallel validation with manual processes</p>
                                    </div>
                                    <div>
                                        <h5 class="font-semibold text-cyan-400 mb-2">Phase 3 Safety</h5>
                                        <p class="text-xs text-slate-300">Gradual rollout with transaction limits, full audit trails, rollback capabilities</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                },
                {
                    title: 'Why Partner With Us',
                    content: `
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                                <h4 class="text-lg font-bold text-white mb-4">üéØ Strategic Alignment</h4>
                                <ul class="space-y-3 text-slate-300">
                                    <li class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span>Complements Orion's <strong class="text-white">Wealth & Asset Management</strong> expertise</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span>Leverages existing <strong class="text-white">Cloud & Infrastructure</strong> capabilities</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span>Enhances <strong class="text-white">Data & Analytics</strong> offerings with trust insights</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span>Integrates with Orion's <strong class="text-white">Generative AI</strong> initiatives</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="bg-slate-800/50 p-6 rounded-xl border border-slate-700">
                                <h4 class="text-lg font-bold text-white mb-4">üíº Market Position</h4>
                                <ul class="space-y-3 text-slate-300">
                                    <li class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span>First-mover advantage in automated trust creation</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span>Addresses $5T+ market with only 2% penetration</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span>Differentiates Orion in competitive FinTech space</span>
                                    </li>
                                    <li class="flex items-start">
                                        <span class="text-cyan-400 mr-2">‚úì</span>
                                        <span>Creates new <strong class="text-white">Platforms & IP</strong> asset for Orion</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="mt-6 bg-gradient-to-r from-blue-600/20 to-cyan-600/20 p-6 rounded-xl border border-blue-500/30">
                            <h4 class="text-lg font-bold text-white mb-3">üöÄ Next Steps</h4>
                            <div class="grid md:grid-cols-3 gap-4">
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-cyan-400 mb-2">1</div>
                                    <p class="text-sm text-slate-300">Proof of Concept with select client</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-cyan-400 mb-2">2</div>
                                    <p class="text-sm text-slate-300">Pilot program across 2-3 delivery centers</p>
                                </div>
                                <div class="text-center">
                                    <div class="text-2xl font-bold text-cyan-400 mb-2">3</div>
                                    <p class="text-sm text-slate-300">Full deployment and market launch</p>
                                </div>
                            </div>
                        </div>
                    `
                }
            ];

            pitchSlides.forEach((slide, index) => {
                const slideDiv = document.createElement('div');
                slideDiv.className = 'glass-panel p-8 rounded-xl';
                slideDiv.innerHTML = `
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center font-bold text-white">
                            ${index + 1}
                        </div>
                        <h3 class="text-2xl font-bold text-white">${slide.title}</h3>
                    </div>
                    <div class="prose prose-invert max-w-none">
                        ${slide.content}
                    </div>
                `;
                container.appendChild(slideDiv);
            });

            // Scroll to the pitch deck section
            document.getElementById('pitch-deck').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Make function globally available
        window.generatePitchDeck = generatePitchDeck;
    </script>
</body>
</html>
